(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{629:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var r=t(5155),l=t(2115);function s(e){let{before:a,after:t,initialPosition:s=.42,className:n,labels:i}=e,o=(0,l.useRef)(null),[d,c]=(0,l.useState)(()=>Math.max(0,Math.min(1,s))),[h,u]=(0,l.useState)(!1),m=(0,l.useCallback)(e=>{if(!h||!o.current)return;let a=o.current.getBoundingClientRect();c(Math.max(0,Math.min(1,(e.clientX-a.left)/Math.max(1,a.width))))},[h]);(0,l.useEffect)(()=>{let e=()=>u(!1),a=e=>m(e);return window.addEventListener("pointerup",e),window.addEventListener("pointermove",a),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointermove",a)}},[m]);let x=Math.round((1-d)*100);return(0,r.jsxs)("div",{ref:o,className:"relative select-none overflow-hidden rounded-lg group "+(null!=n?n:""),role:"group","aria-label":"Before/After comparison",children:[(0,r.jsx)("div",{className:"relative z-0",children:t}),(0,r.jsx)("div",{className:"absolute inset-0",style:{clipPath:"inset(0% ".concat(x,"% 0% 0%)"),WebkitClipPath:"inset(0% ".concat(x,"% 0% 0%)")},"aria-hidden":!0,children:(0,r.jsx)("div",{className:"absolute inset-0",children:a})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-white/40 dark:bg-white/30 shadow pointer-events-none transition-opacity duration-150 group-hover:bg-white/80 dark:group-hover:bg-white/60",style:{left:"".concat(Math.round(100*d),"%")}}),(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2",style:{left:"".concat(Math.round(100*d),"%")},children:(0,r.jsx)("div",{className:"h-10 w-6 rounded bg-white/90 dark:bg-gray-200 text-gray-700 flex items-center justify-center shadow opacity-0 group-hover:opacity-100 transition-opacity duration-150 cursor-col-resize",onPointerDown:e=>{u(!0);try{e.currentTarget.setPointerCapture(e.pointerId)}catch(e){}},role:"slider","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":Number(d.toFixed(2)),"aria-label":"Comparison handle",children:(0,r.jsx)("span",{className:"text-xs",children:"â†”"})})}),(null==i?void 0:i.before)&&(0,r.jsx)("div",{className:"absolute left-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.before}),(null==i?void 0:i.after)&&(0,r.jsx)("div",{className:"absolute right-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.after})]})}function n(e){let{label:a,value:t,min:s,max:n,step:i=1,onChange:o,format:d=e=>String(e),inputWidthPx:c=72,disabled:h}=e,[u,m]=(0,l.useState)(String(t)),x=(0,l.useRef)(null);(0,l.useEffect)(()=>{document.activeElement!==x.current&&m(String(t))},[t]);let g=e=>Math.max(s,Math.min(n,e));return(0,r.jsxs)("div",{className:"space-y-1 "+(h?"opacity-60":""),"aria-disabled":h,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs "+(h?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"),children:a}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=g(t-i);o(e),m(String(e))},disabled:h,"aria-label":"Decrement ".concat(a),children:"âˆ’"}),(0,r.jsx)("input",{type:"number",className:"px-1 py-0.5 bg-gray-50 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 text-xs disabled:opacity-60 disabled:cursor-not-allowed disabled:bg-gray-100 dark:disabled:bg-gray-800",style:{width:c},ref:x,value:u,min:s,max:n,step:i,onChange:e=>m(e.target.value),onBlur:()=>{let e=parseFloat(u);if(isNaN(e))return void m(String(t));let a=g(e);a!==t&&o(a),m(String(a))},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),"Escape"===e.key&&(m(String(t)),e.currentTarget.blur())},disabled:h,"aria-label":"".concat(a," value")}),(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=g(t+i);o(e),m(String(e))},disabled:h,"aria-label":"Increment ".concat(a),children:"+"})]})]}),(0,r.jsx)("input",{type:"range",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50",min:s,max:n,step:i,value:t,onChange:e=>{let a=g(Number(e.target.value));o(a),m(String(a))},disabled:h,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":t}),(0,r.jsx)("div",{className:"text-[10px] "+(h?"text-gray-400 dark:text-gray-500":"text-gray-500 dark:text-gray-400"),children:d(t)})]})}class i{init(){if(this.worker)return;let e=new Worker(t.tu(new URL(t.p+t.u(832),t.b)),{type:void 0});e.postMessage({type:"init",width:256,height:256}),e.onmessage=e=>{var a,t,r,l,s,n,i,o,d,c;let h=e.data;if(h&&h.type)switch(h.type){case"progress":{let e=this.pending.get(h.requestId);e&&"number"==typeof h.progress&&(null==(t=e.events)||null==(a=t.onProgress)||a.call(t,h.progress));break}case"report":{let e=this.pending.get(h.requestId);e&&h.report&&(null==(l=e.events)||null==(r=l.onReport)||r.call(l,h.report));break}case"tile":{let e=this.pending.get(h.requestId);e&&"number"==typeof h.done&&"number"==typeof h.total&&(null==(n=e.events)||null==(s=n.onTile)||s.call(n,h.done,h.total));break}case"result":{let e=this.pending.get(h.requestId);if(e){try{h.report&&(null==(o=e.events)||null==(i=o.onReport)||i.call(o,h.report))}catch(e){}this.pending.delete(h.requestId),e.resolve(h.imageData)}break}case"error":{let e=h.requestId?this.pending.get(h.requestId):void 0;if(e){try{h.report&&(null==(c=e.events)||null==(d=c.onReport)||d.call(c,h.report))}catch(e){}this.pending.delete(h.requestId),e.reject(Error(h&&h.error||"Worker error"))}}}},this.worker=e}async process(e,a,t,r){if(this.init(),!this.worker)throw Error("Worker not available");this.cancel();let l=Math.random().toString(36).slice(2),s=new Promise((e,a)=>{this.pending.set(l,{resolve:e,reject:a,events:t})});return this.worker.postMessage({type:"process",imageData:e,params:a,options:r,requestId:l},[e.data.buffer]),s}cancel(){var e;for(let[a,t]of(null==(e=this.worker)||e.postMessage({type:"cancel"}),this.pending)){try{t.reject(Error("Operation cancelled"))}catch(e){}this.pending.delete(a)}}dispose(){if(this.worker){try{this.worker.postMessage({type:"dispose"})}catch(e){}this.worker.terminate()}this.worker=null}constructor(){this.worker=null,this.pending=new Map}}function o(e){let a="/atelier-of-the-painter".replace(/\/$/,"");if(!e)return a||"/";let t=e.startsWith("/")?e:"/".concat(e);return"".concat(a).concat(t)||t}let d=[{name:"Painterly",params:{kernelSize:28,anisotropy:6.8,sharpness:3.8,alpha:.9,threshold:.2,sectors:6,order:2.4,sigmaSpatial:.7,sigmaRange:.12,adaptStrength:.85,radiusMinScale:.4,radiusMaxScale:1.25,flowSigma:2.4,quantizeLevels:8,quantizeStrength:.45,quantizeDither:.35,softTau:.03,edgeSigma:1,edgeTau:.007,edgePhi:10,edgeMix:.18}},{name:"Soft Portrait",params:{kernelSize:18,anisotropy:6.2,sharpness:2.8,alpha:.85,threshold:.2,sectors:6,order:1.8,sigmaSpatial:.8,sigmaRange:.1,adaptStrength:.8,radiusMinScale:.38,radiusMaxScale:1.15,flowSigma:2,quantizeLevels:8,quantizeStrength:.35,quantizeDither:.3,softTau:.025,edgeSigma:1,edgeTau:.007,edgePhi:10,edgeMix:.18}},{name:"Bold Landscape",params:{kernelSize:60,anisotropy:7.3,sharpness:4.5,alpha:.9,threshold:.21,sectors:6,order:3,sigmaSpatial:.65,sigmaRange:.16,adaptStrength:.9,radiusMinScale:.35,radiusMaxScale:1.35,flowSigma:3,quantizeLevels:12,quantizeStrength:.5,quantizeDither:.45,softTau:.035,edgeSigma:1,edgeTau:.007,edgePhi:12,edgeMix:.2}},{name:"Inked Poster",params:{kernelSize:32,anisotropy:7,sharpness:4.2,alpha:.95,threshold:.21,sectors:8,order:3,sigmaSpatial:.65,sigmaRange:.14,adaptStrength:.9,radiusMinScale:.38,radiusMaxScale:1.35,flowSigma:2.8,quantizeLevels:10,quantizeStrength:.45,quantizeDither:.4,softTau:.035,edgeSigma:1,edgeTau:.007,edgePhi:12,edgeMix:.22}}],c=[{name:"Sample 1",src:o("/0.jpg"),presetIdx:0},{name:"Sample 3",src:o("/2.jpg"),presetIdx:1},{name:"Sample 2",src:o("/1.jpg"),presetIdx:2},{name:"Sample 4",src:o("/3.jpg"),presetIdx:3}],h={kernelSize:28,anisotropy:6.8,sharpness:3.8,alpha:.9,threshold:.2,upscaleFactor:1,preserveSettings:!0,sectors:6,order:2,sigmaSpatial:.7,sigmaRange:.12,adaptStrength:.85,radiusMinScale:.4,radiusMaxScale:1.25,flowSigma:2.4,quantizeLevels:8,quantizeStrength:.45,quantizeDither:.35,softTau:.03,edgeSigma:1,edgeTau:.007,edgePhi:10,edgeMix:.18};function u(){var e,a,t,o,u,g,p,b,y,f,v,j,w,M,N,k;let[S,C]=(0,l.useState)(null),[z,R]=(0,l.useState)(null),[E,q]=(0,l.useState)(null),[D,I]=(0,l.useState)(null),[P,T]=(0,l.useState)(1),[L,W]=(0,l.useState)(!1),[F,O]=(0,l.useState)(0),[U,B]=(0,l.useState)(!0),[A,H]=(0,l.useState)(null),[G,_]=(0,l.useState)([]),[J,K]=(0,l.useState)(-1),X=(0,l.useRef)(null),[V,Y]=(0,l.useState)(h),[Q,$]=(0,l.useState)({enabled:!0,blurEnabled:!1,blurRadius:4,blurAmount:.35,saturation:1,brightness:1,warmth:0,tint:0}),[Z,ee]=(0,l.useState)(2048),[ea,et]=(0,l.useState)(!1),[er,el]=(0,l.useState)(512),[es,en]=(0,l.useState)("area"),[ei,eo]=(0,l.useState)(360),[ed,ec]=(0,l.useState)(null),[eh,eu]=(0,l.useState)(null),[em,ex]=(0,l.useState)(null),[eg,ep]=(0,l.useState)(null),eb=(0,l.useRef)(null),ey=(0,l.useRef)(null),ef=(0,l.useRef)(0);(0,l.useEffect)(()=>(ey.current=new i,()=>{var e;return null==(e=ey.current)?void 0:e.dispose()}),[]);let ev=e=>{try{var a;null==(a=ey.current)||a.cancel()}catch(e){}R(null),I(null),q(null),ec(null),eu(null),ex(null),ep(null),C(e);let t=new Image;t.crossOrigin="anonymous",t.onload=()=>{let e=t.naturalWidth,a=t.naturalHeight,r=Math.max(8,Math.min(Math.floor(ei),Math.min(e,a))),l=Math.floor(r/2),s=Math.floor(e/2),n=Math.floor(a/2),i=Math.max(0,Math.min(s-l,e-r)),o=Math.max(0,Math.min(n-l,a-r));ec({x:s,y:n}),ep({left:i,top:o,size:r}),eu(null),ex(null),R(t)},t.src=e},ej=(0,l.useCallback)(async()=>{var e,a,t,r,l,s,n,i,o,d,c;if(!z||!ey.current)return;let h=++ef.current;try{ey.current.cancel()}catch(e){}let u=(e=>{let a=document.createElement("canvas");a.width=e.naturalWidth,a.height=e.naturalHeight;let t=a.getContext("2d",{willReadFrequently:!0});if(!t)throw Error("2D context");return t.drawImage(e,0,0),t.getImageData(0,0,a.width,a.height)})(z),m=new ImageData(new Uint8ClampedArray(u.data),u.width,u.height);W(!0),O(1);try{let c=ea?{...V,kernelSize:Math.min(V.kernelSize,48),anisotropy:Math.min(V.anisotropy,5),sectors:Math.min(null!=(e=V.sectors)?e:6,4),order:Math.min(null!=(a=V.order)?a:2,2),flowSigma:Math.min(null!=(t=V.flowSigma)?t:2.4,2),radiusMaxScale:Math.min(null!=(r=V.radiusMaxScale)?r:1.25,1.1),sigmaSpatial:Math.min(null!=(l=V.sigmaSpatial)?l:.7,.8),sigmaRange:Math.max(.08,Math.min(null!=(s=V.sigmaRange)?s:.12,.2)),quantizeLevels:Math.min(null!=(n=V.quantizeLevels)?n:8,8),quantizeDither:Math.min(null!=(i=V.quantizeDither)?i:.35,.35),edgeSigma:Math.min(null!=(o=V.edgeSigma)?o:1,1),edgeMix:Math.min(null!=(d=V.edgeMix)?d:.18,.2)}:V;if("compare"===es){let e=Math.min(u.width,u.height),a=Math.max(1,Math.ceil(Z/Math.max(1,e)));ef.current===h&&I(m);let t=await ey.current.process(u,{...c,upscaleFactor:a,preserveSettings:!0},{onProgress:e=>{ef.current===h&&O(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{if(ef.current===h){H(e),_(a=>[e,...a].slice(0,10));try{console.info("[Kuwahara Render Report]",e)}catch(e){}}}},{scale:a,preprocess:Q,tileSize:ea?Math.min(er,256):er});ef.current===h&&(q(t),O(100))}else{let e=Math.max(8,Math.min(Math.floor(ei),u.width,u.height)),a=null!=ed?ed:{x:Math.floor(u.width/2),y:Math.floor(u.height/2)},t=Math.floor(e/2),r=Math.max(0,Math.min(a.x-t,u.width-e)),l=Math.max(0,Math.min(a.y-t,u.height-e)),s=document.createElement("canvas");s.width=u.width,s.height=u.height;let n=s.getContext("2d",{willReadFrequently:!0});if(!n)throw Error("2D context");n.putImageData(u,0,0);let i=document.createElement("canvas");i.width=e,i.height=e;let o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw Error("2D context");o.drawImage(s,r,l,e,e,0,0,e,e);let d=o.getImageData(0,0,e,e);if(ef.current!==h)return;ec(a),ep({left:r,top:l,size:e});let m=new ImageData(new Uint8ClampedArray(d.data),d.width,d.height);eu(m),ex(null);let x=await ey.current.process(d,{...c,upscaleFactor:1,preserveSettings:!0},{onProgress:e=>{ef.current===h&&O(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{if(ef.current===h){H(e),_(a=>[e,...a].slice(0,10));try{console.info("[Kuwahara Render Report]",e)}catch(e){}}}},{scale:1,preprocess:Q,tileSize:ea?Math.min(er,256):er});ef.current===h&&(ex(x),O(100))}}catch(a){let e=(null==a?void 0:a.message)||String(a);if("Operation cancelled"!==e&&(console.error(a),/webgl|context lost|webgl2|exhausted|limits unavailable|failed to create webgl/i.test(e))){B(!1);try{null==(c=ey.current)||c.dispose()}catch(e){}}}finally{ef.current===h&&W(!1)}},[z,V,Z,Q,ea,es,ei,ed]),ew=(0,l.useCallback)(()=>{let e=eb.current;if(!e)return;let a=e.naturalWidth,t=e.naturalHeight;if(!a||!t)return;let r=Math.max(8,Math.min(Math.floor(ei),Math.min(a,t))),l=Math.floor(r/2),s=Math.floor(a/2),n=Math.floor(t/2),i=Math.max(0,Math.min(s-l,a-r)),o=Math.max(0,Math.min(n-l,t-r));ec({x:s,y:n}),ep({left:i,top:o,size:r}),eu(null),ex(null),R(e)},[ei]);return(0,l.useEffect)(()=>{if(z){try{var e;null==(e=ey.current)||e.cancel()}catch(e){}ej()}},[z]),(0,l.useEffect)(()=>{if(!z)return;try{var e;null==(e=ey.current)||e.cancel()}catch(e){}let a=setTimeout(()=>{ej()},300);return()=>{clearTimeout(a);try{var e;null==(e=ey.current)||e.cancel()}catch(e){}}},[V,Q,Z,es,ea]),(0,l.useEffect)(()=>{if(!z)return;try{var e;null==(e=ey.current)||e.cancel()}catch(e){}let a=setTimeout(()=>{ej()},150);return()=>{clearTimeout(a);try{var e;null==(e=ey.current)||e.cancel()}catch(e){}}},[ed,ei]),(0,r.jsxs)("div",{className:"flex h-screen text-gray-900 dark:text-gray-100",children:[(0,r.jsxs)("aside",{className:"w-[340px] max-h-full shrink-0 dark:border-gray-800 p-4 space-y-6 overflow-y-auto",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"w-full block text-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer text-xs",children:["Upload",(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];t&&(e=>{let a=new FileReader;a.onload=()=>ev(String(a.result)),a.readAsDataURL(e)})(t)}})]}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:c.map(e=>{let a=S===e.src;return(0,r.jsx)("button",{onClick:()=>{Y(a=>({...a,...d[e.presetIdx].params})),ev(e.src)},className:"relative aspect-square rounded overflow-hidden border focus:outline-none "+(a?"ring-2 ring-blue-500 border-blue-500":"border-gray-300 dark:border-gray-700 hover:border-blue-400 dark:hover:outline-blue-400"),"aria-pressed":a,children:(0,r.jsx)("img",{src:e.src,alt:e.name,loading:"lazy",className:"w-full h-full object-cover"})},e.src)})})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Presets"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:d.map(e=>(0,r.jsx)("button",{className:"px-2 py-2 text-xs rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-200/60 dark:hover:bg-gray-700/60",onClick:()=>Y(a=>({...a,...e.params})),children:e.name},e.name))})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Basic"}),(0,r.jsx)(n,{label:"Brush size",value:V.kernelSize,min:1,max:200,step:1,onChange:e=>Y(a=>({...a,kernelSize:e}))}),(0,r.jsx)(n,{label:"Directionality",value:V.anisotropy,min:1,max:8,step:.1,onChange:e=>Y(a=>({...a,anisotropy:e}))}),(0,r.jsx)(n,{label:"Sharpness",value:V.sharpness,min:1,max:10,step:.1,onChange:e=>Y(a=>({...a,sharpness:e}))}),(0,r.jsx)(n,{label:"Stylization",value:V.alpha,min:.1,max:2,step:.05,onChange:e=>Y(a=>({...a,alpha:e}))}),(0,r.jsx)(n,{label:"Edge preservation",value:V.threshold,min:.01,max:1,step:.01,onChange:e=>Y(a=>({...a,threshold:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",open:!0,children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Preprocess"}),(0,r.jsxs)("div",{className:" flex flex-col space-y-4",children:[(0,r.jsxs)("label",{className:"text-xs inline-flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:ea,onChange:e=>et(e.target.checked)})," ","Stability mode"]}),(0,r.jsxs)("label",{className:"text-xs inline-flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:Q.blurEnabled,onChange:e=>$({...Q,blurEnabled:e.target.checked}),disabled:!Q.enabled})," ","Edge-aware smoothing"]})]}),(0,r.jsx)(n,{label:"Blur radius",value:Q.blurRadius,min:0,max:16,step:1,onChange:e=>$({...Q,blurRadius:e}),disabled:!Q.enabled||!Q.blurEnabled}),(0,r.jsx)(n,{label:"Blur amount",value:Q.blurAmount,min:0,max:1,step:.05,onChange:e=>$({...Q,blurAmount:e}),disabled:!Q.enabled||!Q.blurEnabled}),(0,r.jsx)(n,{label:"Saturation",value:Q.saturation,min:0,max:2,step:.05,onChange:e=>$({...Q,saturation:e}),disabled:!Q.enabled}),(0,r.jsx)(n,{label:"Brightness",value:Q.brightness,min:0,max:2,step:.05,onChange:e=>$({...Q,brightness:e}),disabled:!Q.enabled}),(0,r.jsx)(n,{label:"Warmth",value:Q.warmth,min:-1,max:1,step:.05,onChange:e=>$({...Q,warmth:e}),disabled:!Q.enabled}),(0,r.jsx)(n,{label:"Tint",value:Q.tint,min:-1,max:1,step:.05,onChange:e=>$({...Q,tint:e}),disabled:!Q.enabled})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Palette"}),(0,r.jsx)(n,{label:"Levels",value:null!=(e=V.quantizeLevels)?e:0,min:0,max:64,step:1,onChange:e=>Y(a=>({...a,quantizeLevels:e}))}),(0,r.jsx)(n,{label:"Strength",value:null!=(a=V.quantizeStrength)?a:.6,min:0,max:1,step:.05,onChange:e=>Y(a=>({...a,quantizeStrength:e}))}),(0,r.jsx)(n,{label:"Dither",value:null!=(t=V.quantizeDither)?t:.35,min:0,max:1,step:.05,onChange:e=>Y(a=>({...a,quantizeDither:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Stroke & coherence"}),(0,r.jsx)(n,{label:"Sectors",value:null!=(o=V.sectors)?o:6,min:1,max:8,step:1,onChange:e=>Y(a=>({...a,sectors:e}))}),(0,r.jsx)(n,{label:"Contrast blend (p)",value:null!=(u=V.order)?u:1,min:0,max:6,step:.5,onChange:e=>Y(a=>({...a,order:e}))}),(0,r.jsx)(n,{label:"Flow scale",value:null!=(g=V.flowSigma)?g:2,min:0,max:6,step:.5,onChange:e=>Y(a=>({...a,flowSigma:e}))}),(0,r.jsx)(n,{label:"Adaptive",value:null!=(p=V.adaptStrength)?p:.75,min:0,max:1,step:.05,onChange:e=>Y(a=>({...a,adaptStrength:e}))}),(0,r.jsx)(n,{label:"Min brush",value:null!=(b=V.radiusMinScale)?b:.35,min:.1,max:1,step:.05,onChange:e=>Y(a=>({...a,radiusMinScale:e}))}),(0,r.jsx)(n,{label:"Max brush",value:null!=(y=V.radiusMaxScale)?y:1,min:.5,max:1.5,step:.05,onChange:e=>Y(a=>({...a,radiusMaxScale:e}))}),(0,r.jsx)(n,{label:"Local softness",value:null!=(f=V.sigmaSpatial)?f:.5,min:.1,max:1.5,step:.05,onChange:e=>Y(a=>({...a,sigmaSpatial:e}))}),(0,r.jsx)(n,{label:"Color edge sens.",value:null!=(v=V.sigmaRange)?v:.15,min:.01,max:.5,step:.01,onChange:e=>Y(a=>({...a,sigmaRange:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Ink outlines"}),(0,r.jsx)(n,{label:"Ink sigma",value:null!=(j=V.edgeSigma)?j:0,min:.1,max:3,step:.1,onChange:e=>Y(a=>({...a,edgeSigma:e}))}),(0,r.jsx)(n,{label:"Ink threshold (Ï„)",value:null!=(w=V.edgeTau)?w:0,min:.001,max:.02,step:.001,onChange:e=>Y(a=>({...a,edgeTau:e}))}),(0,r.jsx)(n,{label:"Ink slope (Ï†)",value:null!=(M=V.edgePhi)?M:10,min:1,max:20,step:1,onChange:e=>Y(a=>({...a,edgePhi:e}))}),(0,r.jsx)(n,{label:"Ink mix",value:null!=(N=V.edgeMix)?N:0,min:0,max:1,step:.05,onChange:e=>Y(a=>({...a,edgeMix:e}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Output"}),(0,r.jsx)(n,{label:"Min short side (px)",value:Z,min:256,max:8192,step:64,onChange:ee})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Performance"}),(0,r.jsx)(n,{label:"Tile size (px)",value:er,min:128,max:2048,step:64,onChange:el}),(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-400",children:"Larger tiles are faster but use more GPU memory. Stability mode caps at 256."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Preview"}),(0,r.jsx)(n,{label:"Area size (px)",value:ei,min:64,max:1024,step:16,onChange:e=>eo(e)})]})]}),(0,r.jsxs)("main",{className:"flex flex-col flex-1 p-4",children:[(0,r.jsxs)("div",{className:"flex-none flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mr-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("area"===es?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>en("area"),children:"Area Preview"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("compare"===es?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>en("compare"),children:"Full Preview"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>T(e=>Math.max(.25,e-.25)),children:"âˆ’"}),(0,r.jsxs)("span",{className:"text-xs w-16 text-center",children:[Math.round(100*P),"%"]}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>T(e=>Math.min(4,e+.25)),children:"+"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>T(1),children:"Reset"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700 disabled:opacity-50",disabled:!E||L,onClick:()=>{if(!E)return;let e=document.createElement("canvas");e.width=E.width,e.height=E.height;let a=e.getContext("2d");a&&(a.putImageData(E,0,0),e.toBlob(e=>{if(!e)return;let a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="kuwahara-".concat(Date.now(),".png"),t.click(),setTimeout(()=>{try{URL.revokeObjectURL(a)}catch(e){}},0)},"image/png"))},children:"Download PNG"})]})]}),(0,r.jsxs)("div",{className:"relative flex-1 flex flex-col justify-center bg-gray-200 dark:bg-gray-800 rounded-xl min-h-[360px]",children:[(0,r.jsxs)("div",{className:"flex-none max-h-full overflow-y-auto p-4",children:[!S&&(0,r.jsx)("div",{className:"h-[480px] flex items-center justify-center text-sm text-gray-500",children:"No image loaded"}),S&&"compare"===es&&D&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{className:"w-full",labels:{before:"Before",after:U?L||!E?"Previewingâ€¦":"After":"GPU unavailable"},before:(0,r.jsx)(m,{imageData:D,zoom:P}),after:L||!E?(0,r.jsx)(m,{imageData:D,zoom:P,cssFilter:"blur(8px)"}):(0,r.jsx)(m,{imageData:E,zoom:P})}),L&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[F,"%"]})]}),S&&"area"===es&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsxs)("div",{className:"relative overflow-clip inline-block max-w-full",style:{maxWidth:"400px",maxHeight:"400px"},children:[(0,r.jsx)("img",{ref:eb,src:S,alt:"original",crossOrigin:"anonymous",className:"max-w-full h-auto rounded",onClick:e=>{if(!z||!eb.current)return;let a=eb.current.getBoundingClientRect(),t=e.clientX-a.left,r=e.clientY-a.top,l=z.naturalWidth/Math.max(1,a.width),s=z.naturalHeight/Math.max(1,a.height),n=Math.floor(t*l),i=Math.floor(r*s),o=Math.max(8,Math.min(ei,Math.min(z.naturalWidth,z.naturalHeight))),d=Math.floor(o/2),c=Math.max(d,Math.min(n,z.naturalWidth-d)),h=Math.max(d,Math.min(i,z.naturalHeight-d));ec({x:c,y:h}),ep({left:Math.max(0,Math.min(c-d,z.naturalWidth-o)),top:Math.max(0,Math.min(h-d,z.naturalHeight-o)),size:o})},onLoad:ew}),z&&(0,r.jsx)(x,{imageEl:eb.current,naturalWidth:z.naturalWidth,naturalHeight:z.naturalHeight,areaCenter:ed,areaSize:ei,areaBefore:eh,areaAfter:em,isBusy:L,areaCrop:eg})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-4xl mx-auto",children:[(0,r.jsx)("div",{className:"aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:eh?(0,r.jsx)(m,{imageData:eh,zoom:1}):(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Pick a point"})}),(0,r.jsxs)("div",{className:"relative aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:[L&&eh&&!em&&(0,r.jsx)(m,{imageData:eh,zoom:1,cssFilter:"blur(8px)"}),em&&(0,r.jsx)(m,{imageData:em,zoom:1}),L&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[F,"%"]})]})]})]})]}),!U&&(0,r.jsxs)("div",{className:"absolute left-4 bottom-4 right-4 sm:right-auto sm:max-w-xl text-xs px-3 py-2 rounded bg-yellow-200/90 text-yellow-900 dark:bg-yellow-500/20 dark:text-yellow-200 border border-yellow-400/60 flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{children:"GPU/WebGL became unavailable. Results are limited. Try retrying or reloading."}),A&&(0,r.jsxs)("div",{className:"mt-1 text-[11px] text-yellow-900/90 dark:text-yellow-200/80",children:[(0,r.jsxs)("span",{className:"mr-2",children:["Failed step: ",(0,r.jsx)("b",{children:null!=(k=A.failedStep)?k:"â€”"})]}),!!(A.errors&&A.errors.length)&&(0,r.jsxs)("span",{className:"mr-2",children:["Error:"," ","".concat(A.errors[0].where,":").concat(A.errors[0].label)]}),A.vendor&&A.renderer&&(0,r.jsxs)("span",{className:"mr-2",children:["GPU: ",A.vendor," \xb7 ",A.renderer]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:()=>{try{var e;null==(e=X.current)||e.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}},title:"Scroll to diagnostics",children:"Details"}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(A,null,2))}catch(e){}},title:"Copy report JSON",children:"Copy report"})]}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/60 dark:bg-white/10",onClick:()=>{B(!0);try{var e;null==(e=ey.current)||e.dispose()}catch(e){}ey.current=new i;try{ej()}catch(e){}},children:"Retry"})]})]})]}),(0,r.jsxs)("div",{ref:X,className:"mt-3 text-[11px] leading-5 bg-white/70 dark:bg-black/30 backdrop-blur rounded border border-gray-300 dark:border-gray-700 p-3 max-w-full overflow-x-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Render Diagnostics"}),(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-300",children:A?"Latest report":"No render yet"})]}),(0,r.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[10px] text-gray-500",children:"History:"}),0===G.length&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400",children:"â€”"}),G.map((e,a)=>{var t,l,s,n,i;return(0,r.jsxs)("button",{className:"px-2 py-0.5 rounded border text-[10px] ".concat(a===J?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>K(a===J?-1:a),title:"Select report ".concat(a+1),children:[null!=(l=e.mode)?l:"fast","/",Math.round(null!=(n=null!=(s=e.durationMs)?s:null==(t=e.worker)?void 0:t.overallMs)?n:0),"ms"]},(null!=(i=e.requestId)?i:"")+"-"+a)}),G.length>0&&(0,r.jsx)("button",{className:"ml-2 px-2 py-0.5 rounded border text-[10px] border-gray-300 dark:border-gray-700",onClick:()=>{_([]),K(-1)},children:"Clear"})]}),(()=>{var e,a,t,l,s,n,i,o,d,c,h,u,m;let x=J>=0?G[J]:A;return x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Mode:"})," ",x.mode]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Failed step:"})," ",null!=(a=x.failedStep)?a:"â€”"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Duration:"})," ",Math.round(null!=(l=null!=(t=x.durationMs)?t:null==(e=x.worker)?void 0:e.overallMs)?l:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"GPU time:"})," ",x.gpuTimeNs?"".concat(Math.round(x.gpuTimeNs/1e6)," ms"):"â€”"," ",x.gpuDisjoint?"(disjoint)":""]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Original:"})," ",x.originalSize?"".concat(x.originalSize.w,"\xd7").concat(x.originalSize.h):"â€”"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Target:"})," ",x.targetSize?"".concat(x.targetSize.w,"\xd7").concat(x.targetSize.h):"â€”"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Vendor:"})," ",null!=(s=x.vendor)?s:"â€”"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Renderer:"})," ",null!=(n=x.renderer)?n:"â€”"]})]}),!!(x.errors&&x.errors.length)&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Errors:"})," ",x.errors.map((e,a)=>"".concat(e.where,":").concat(e.label)).join(", ")]}),!!(x.notes&&x.notes.length)&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Notes"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1",children:x.notes.map((e,a)=>(0,r.jsx)("li",{children:e},a))})]}),x.worker&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Worker metrics"}),(0,r.jsxs)("div",{className:"mt-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Canceled:"})," ",x.worker.canceled?"yes":"no"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Retries:"})," ",null!=(i=x.worker.retries)?i:0]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Preprocess:"})," ",Math.round(null!=(o=x.worker.preprocessMs)?o:0)," ms"]}),x.worker.tiling&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles:"})," ",x.worker.tiling.tilesX,"\xd7",x.worker.tiling.tilesY," ","(",x.worker.tiling.totalTiles,") @"," ",x.worker.tiling.tileSize]}),x.worker.aggregates&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles total:"})," ",Math.round(null!=(d=x.worker.aggregates.tilesTotalMs)?d:0)," ","ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Avg / tile:"})," ",Math.round(null!=(c=x.worker.aggregates.tileAvgMs)?c:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Max tile:"})," ",Math.round(null!=(h=x.worker.aggregates.tileMaxMs)?h:0)," ","ms (#",(null!=(u=x.worker.aggregates.tileMaxIndex)?u:0)+1,")"]})]})]}),x.worker.tiles&&x.worker.tiles.length>0&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Per-tile timings"}),(0,r.jsx)("div",{className:"mt-1 max-h-64 overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-[10px]",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-gray-500",children:[(0,r.jsx)("th",{className:"text-left",children:"Tile"}),(0,r.jsx)("th",{className:"text-right",children:"Crop"}),(0,r.jsx)("th",{className:"text-right",children:"GPU"}),(0,r.jsx)("th",{className:"text-right",children:"Compose"}),(0,r.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,r.jsx)("tbody",{children:x.worker.tiles.map((e,a)=>{var t,l,s,n,i;return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{children:["(",e.tx,",",e.ty,") ",e.wOut,"\xd7",e.hOut]}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(l=e.cropMs)?l:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(s=null==(t=e.gpu)?void 0:t.totalMs)?s:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(n=e.composeMs)?n:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(i=e.totalMs)?i:0)})]},a)})})]})})]})]}),(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Uniforms"}),(0,r.jsx)("pre",{className:"mt-1 text-[10px] whitespace-pre-wrap break-all",children:JSON.stringify(null!=(m=x.uniforms)?m:{},null,2)})]})]}):(0,r.jsx)("div",{className:"mt-2 text-[10px] text-gray-600 dark:text-gray-300",children:"Run a render to see diagnostics here."})})()]})]})]})}function m(e){let{imageData:a,zoom:t,cssFilter:s,className:n,style:i}=e,o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{let r=o.current;if(!r)return;let l=Math.max(1,Math.floor(a.width*Math.max(.01,t))),s=Math.max(1,Math.floor(a.height*Math.max(.01,t)));r.width=l,r.height=s;let n=r.getContext("2d");if(n)try{let t=await createImageBitmap(a);if(e){try{t.close()}catch(e){}return}n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.clearRect(0,0,l,s),n.drawImage(t,0,0,l,s);try{t.close()}catch(e){}}catch(r){let e=document.createElement("canvas");e.width=a.width,e.height=a.height;let t=e.getContext("2d");if(t)try{t.putImageData(a,0,0),n.drawImage(e,0,0,l,s)}catch(e){}}})(),()=>{e=!0}},[a,t]),(0,r.jsx)("canvas",{ref:o,className:null!=n?n:"block max-w-full h-auto mx-auto rounded",style:{...s?{filter:s}:{},...i||{}}})}function x(e){let{imageEl:a,naturalWidth:t,naturalHeight:s,areaCenter:n,areaSize:i,areaBefore:o,areaAfter:d,isBusy:c,areaCrop:h}=e,[u,x]=(0,l.useState)({w:0,h:0});if((0,l.useEffect)(()=>{if(!a)return;let e=new ResizeObserver(e=>{var t;let r=null==(t=e[0])?void 0:t.contentRect;r?x({w:Math.round(r.width),h:Math.round(r.height)}):x({w:a.clientWidth,h:a.clientHeight})});return x({w:a.clientWidth,h:a.clientHeight}),e.observe(a),()=>{try{e.disconnect()}catch(e){}}},[a]),!a||!n||0===u.w||0===u.h)return null;let g=u.w/Math.max(1,t),p=u.h/Math.max(1,s),b=h?h.size:Math.max(8,Math.min(Math.floor(i),Math.min(t,s))),y=Math.floor(b/2),f=h?h.left+y:Math.max(y,Math.min(n.x,t-y)),v=h?h.top+y:Math.max(y,Math.min(n.y,s-y)),j=h?h.left:f-y,w=h?h.top:v-y,M=Math.round(j*g),N=Math.round(w*p),k=Math.max(1,Math.round(b*g)),S=Math.max(1,Math.round(b*p));return(0,r.jsx)("div",{style:{position:"absolute",left:M,top:N,width:k,height:S,outline:"1px solid #fff5",boxShadow:"0 0 0 9999px rgba(0,0,0,0.25)",pointerEvents:"none",overflow:"hidden"},children:!c&&d?(0,r.jsx)(m,{imageData:d,zoom:1,className:"block w-full h-full",style:{width:"100%",height:"100%"}}):null})}},5697:(e,a,t)=>{Promise.resolve().then(t.bind(t,629))}},e=>{e.O(0,[623,358],()=>e(e.s=5697)),_N_E=e.O()}]);