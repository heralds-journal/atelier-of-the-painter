(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3100:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(5155),l=a(2115);function s(e){let{before:t,after:a,initialPosition:s=.42,className:n,labels:i}=e,o=(0,l.useRef)(null),[d,u]=(0,l.useState)(()=>Math.max(0,Math.min(1,s))),[c,h]=(0,l.useState)(!1),m=(0,l.useCallback)(e=>{if(!c||!o.current)return;let t=o.current.getBoundingClientRect();u(Math.max(0,Math.min(1,(e.clientX-t.left)/Math.max(1,t.width))))},[c]);(0,l.useEffect)(()=>{let e=()=>h(!1),t=e=>m(e);return window.addEventListener("pointerup",e),window.addEventListener("pointermove",t),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointermove",t)}},[m]);let x=Math.round((1-d)*100);return(0,r.jsxs)("div",{ref:o,className:"relative select-none overflow-hidden rounded-lg group "+(null!=n?n:""),role:"group","aria-label":"Before/After comparison",children:[(0,r.jsx)("div",{className:"relative z-0",children:a}),(0,r.jsx)("div",{className:"absolute inset-0",style:{clipPath:"inset(0% ".concat(x,"% 0% 0%)"),WebkitClipPath:"inset(0% ".concat(x,"% 0% 0%)")},"aria-hidden":!0,children:(0,r.jsx)("div",{className:"absolute inset-0",children:t})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-white/40 dark:bg-white/30 shadow pointer-events-none transition-opacity duration-150 group-hover:bg-white/80 dark:group-hover:bg-white/60",style:{left:"".concat(Math.round(100*d),"%")}}),(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2",style:{left:"".concat(Math.round(100*d),"%")},children:(0,r.jsx)("div",{className:"h-10 w-6 rounded bg-white/90 dark:bg-gray-200 text-gray-700 flex items-center justify-center shadow opacity-0 group-hover:opacity-100 transition-opacity duration-150 cursor-col-resize",onPointerDown:e=>{h(!0);try{e.currentTarget.setPointerCapture(e.pointerId)}catch(e){}},role:"slider","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":Number(d.toFixed(2)),"aria-label":"Comparison handle",children:(0,r.jsx)("span",{className:"text-xs",children:"↔"})})}),(null==i?void 0:i.before)&&(0,r.jsx)("div",{className:"absolute left-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.before}),(null==i?void 0:i.after)&&(0,r.jsx)("div",{className:"absolute right-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.after})]})}function n(e){let{label:t,value:a,min:s,max:n,step:i=1,onChange:o,format:d=e=>String(e),inputWidthPx:u=72,disabled:c,subtitle:h}=e,[m,x]=(0,l.useState)(String(a)),g=(0,l.useRef)(null);(0,l.useEffect)(()=>{document.activeElement!==g.current&&x(String(a))},[a]);let p=e=>Math.max(s,Math.min(n,e));return(0,r.jsxs)("div",{className:"space-y-1 "+(c?"opacity-60":""),"aria-disabled":c,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs "+(c?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"),children:t}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=p(a-i);o(e),x(String(e))},disabled:c,"aria-label":"Decrement ".concat(t),children:"−"}),(0,r.jsx)("input",{type:"number",className:"px-1 py-0.5 bg-gray-50 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 text-xs disabled:opacity-60 disabled:cursor-not-allowed disabled:bg-gray-100 dark:disabled:bg-gray-800",style:{width:u},ref:g,value:m,min:s,max:n,step:i,onChange:e=>x(e.target.value),onBlur:()=>{let e=parseFloat(m);if(isNaN(e))return void x(String(a));let t=p(e);t!==a&&o(t),x(String(t))},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),"Escape"===e.key&&(x(String(a)),e.currentTarget.blur())},disabled:c,"aria-label":"".concat(t," value")}),(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=p(a+i);o(e),x(String(e))},disabled:c,"aria-label":"Increment ".concat(t),children:"+"})]})]}),h&&(0,r.jsx)("div",{className:"text-[10px] leading-4 "+(c?"text-gray-400 dark:text-gray-500":"text-gray-500 dark:text-gray-400"),children:h}),(0,r.jsx)("input",{type:"range",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50",min:s,max:n,step:i,value:a,onChange:e=>{let t=p(Number(e.target.value));o(t),x(String(t))},disabled:c,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":a}),(0,r.jsx)("div",{className:"text-[10px] "+(c?"text-gray-400 dark:text-gray-500":"text-gray-500 dark:text-gray-400"),children:d(a)})]})}function i(e){let{imageData:t,zoom:a,cssFilter:s,className:n,style:i}=e,o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{let r=o.current;if(!r)return;let l=Math.max(1,Math.floor(t.width*Math.max(.01,a))),s=Math.max(1,Math.floor(t.height*Math.max(.01,a)));r.width=l,r.height=s;let n=r.getContext("2d");if(n)try{let a=await createImageBitmap(t);if(e){try{a.close()}catch(e){}return}n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.clearRect(0,0,l,s),n.drawImage(a,0,0,l,s);try{a.close()}catch(e){}}catch(r){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let a=e.getContext("2d");if(a)try{a.putImageData(t,0,0),n.drawImage(e,0,0,l,s)}catch(e){}}})(),()=>{e=!0}},[t,a]),(0,r.jsx)("canvas",{ref:o,className:null!=n?n:"block max-w-full h-auto mx-auto rounded",style:{...s?{filter:s}:{},...i||{}}})}function o(e){let{imageEl:t,naturalWidth:a,naturalHeight:s,areaCenter:n,areaSize:o,areaAfter:d,isBusy:u,areaCrop:c}=e,[h,m]=(0,l.useState)({w:0,h:0});if((0,l.useEffect)(()=>{if(!t)return;let e=new ResizeObserver(e=>{var a;let r=null==(a=e[0])?void 0:a.contentRect;r?m({w:Math.round(r.width),h:Math.round(r.height)}):m({w:t.clientWidth,h:t.clientHeight})});return m({w:t.clientWidth,h:t.clientHeight}),e.observe(t),()=>{try{e.disconnect()}catch(e){}}},[t]),!t||!n||0===h.w||0===h.h)return null;let x=h.w/Math.max(1,a),g=h.h/Math.max(1,s),p=c?c.size:Math.max(8,Math.min(Math.floor(o),Math.min(a,s))),b=Math.floor(p/2),f=c?c.left+b:Math.max(b,Math.min(n.x,a-b)),y=c?c.top+b:Math.max(b,Math.min(n.y,s-b)),v=c?c.left:f-b,w=c?c.top:y-b,j=Math.round(v*x),M=Math.round(w*g),k=Math.max(1,Math.round(p*x)),S=Math.max(1,Math.round(p*g));return(0,r.jsx)("div",{style:{position:"absolute",left:j,top:M,width:k,height:S,outline:"1px solid #fff5",boxShadow:"0 0 0 9999px rgba(0,0,0,0.25)",pointerEvents:"none",overflow:"hidden"},children:!u&&d?(0,r.jsx)(i,{imageData:d,zoom:1,className:"block w-full h-full",style:{width:"100%",height:"100%"}}):null})}let d=[{name:"Painterly",params:{kernelSize:28,anisotropy:6.5,sharpness:4.8,alpha:1,threshold:.18,sectors:6,order:2.8,sigmaSpatial:.55,sigmaRange:.1,adaptStrength:.85,radiusMinScale:.45,radiusMaxScale:1.1,flowSigma:2.4,quantizeLevels:10,quantizeStrength:.55,quantizeDither:.3,softTau:.02,edgeSigma:1,edgeTau:.007,edgePhi:10,edgeMix:.16},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1.05,brightness:1,warmth:0,tint:0}},{name:"Soft Portrait",params:{kernelSize:20,anisotropy:5.5,sharpness:3.2,alpha:.95,threshold:.18,sectors:4,order:1,sigmaSpatial:.85,sigmaRange:.14,adaptStrength:.8,radiusMinScale:.4,radiusMaxScale:1.15,flowSigma:2,quantizeLevels:20,quantizeStrength:.45,quantizeDither:.3,softTau:.03,edgeSigma:.9,edgeTau:.008,edgePhi:10,edgeMix:.12},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.18,saturation:1.05,brightness:1,warmth:0,tint:0}},{name:"Bold Landscape",params:{kernelSize:56,anisotropy:7,sharpness:5.2,alpha:1,threshold:.18,sectors:6,order:3.2,sigmaSpatial:.5,sigmaRange:.12,adaptStrength:.9,radiusMinScale:.42,radiusMaxScale:1.15,flowSigma:2.8,quantizeLevels:10,quantizeStrength:.6,quantizeDither:.35,softTau:.02,edgeSigma:1,edgeTau:.007,edgePhi:12,edgeMix:.2},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1.05,brightness:1,warmth:0,tint:0}},{name:"Inked Poster",params:{kernelSize:30,anisotropy:6,sharpness:5,alpha:1,threshold:.18,sectors:4,order:3.6,sigmaSpatial:.45,sigmaRange:.1,adaptStrength:.9,radiusMinScale:.45,radiusMaxScale:1.15,flowSigma:2.6,quantizeLevels:8,quantizeStrength:.65,quantizeDither:.35,softTau:0,edgeSigma:1,edgeTau:.008,edgePhi:12,edgeMix:.25},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1,brightness:1,warmth:0,tint:0}},{name:"Oil Paint",params:{kernelSize:36,anisotropy:6.5,sharpness:6,alpha:1,threshold:.16,sectors:4,order:3.5,sigmaSpatial:.4,sigmaRange:.1,adaptStrength:.9,radiusMinScale:.5,radiusMaxScale:1.1,flowSigma:2.4,quantizeLevels:8,quantizeStrength:.7,quantizeDither:.3,softTau:0,edgeSigma:1,edgeTau:.008,edgePhi:12,edgeMix:.18},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1,brightness:1,warmth:0,tint:0}},{name:"Watercolor",params:{kernelSize:26,anisotropy:5,sharpness:3.4,alpha:1,threshold:.18,sectors:4,order:1.5,sigmaSpatial:.9,sigmaRange:.16,adaptStrength:.8,radiusMinScale:.4,radiusMaxScale:1.15,flowSigma:2,quantizeLevels:16,quantizeStrength:.5,quantizeDither:.35,softTau:.035,edgeSigma:.8,edgeTau:.008,edgePhi:10,edgeMix:.1},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.25,saturation:1.05,brightness:1,warmth:0,tint:0}}],u={kernelSize:28,anisotropy:6.5,sharpness:4.8,alpha:1,threshold:.18,upscaleFactor:1,preserveSettings:!0,sectors:6,order:2.8,sigmaSpatial:.55,sigmaRange:.1,adaptStrength:.85,radiusMinScale:.45,radiusMaxScale:1.1,flowSigma:2.4,quantizeLevels:10,quantizeStrength:.55,quantizeDither:.3,softTau:.02,edgeSigma:1,edgeTau:.007,edgePhi:10,edgeMix:.16};function c(e){let t="/atelier-of-the-painter".replace(/\/$/,"");if(!e)return t||"/";let a=e.startsWith("/")?e:"/".concat(e);return"".concat(t).concat(a)||a}let h=[{name:"Sample 1",src:c("/0.jpg"),presetIdx:0},{name:"Sample 3",src:c("/2.jpg"),presetIdx:1},{name:"Sample 2",src:c("/1.jpg"),presetIdx:2},{name:"Sample 4",src:c("/3.jpg"),presetIdx:3}];class m{init(){if(this.worker)return;let e=new Worker(a.tu(new URL(a.p+a.u(832),a.b)),{type:void 0});e.postMessage({type:"init",width:256,height:256}),e.onmessage=e=>{var t,a,r,l,s,n,i,o,d,u;let c=e.data;if(c&&c.type)switch(c.type){case"progress":{let e=this.pending.get(c.requestId);e&&"number"==typeof c.progress&&(null==(a=e.events)||null==(t=a.onProgress)||t.call(a,c.progress));break}case"report":{let e=this.pending.get(c.requestId);e&&c.report&&(null==(l=e.events)||null==(r=l.onReport)||r.call(l,c.report));break}case"tile":{let e=this.pending.get(c.requestId);e&&"number"==typeof c.done&&"number"==typeof c.total&&(null==(n=e.events)||null==(s=n.onTile)||s.call(n,c.done,c.total));break}case"result":{let e=this.pending.get(c.requestId);if(e){try{c.report&&(null==(o=e.events)||null==(i=o.onReport)||i.call(o,c.report))}catch(e){}this.pending.delete(c.requestId),e.resolve(c.imageData)}break}case"error":{let e=c.requestId?this.pending.get(c.requestId):void 0;if(e){try{c.report&&(null==(u=e.events)||null==(d=u.onReport)||d.call(u,c.report))}catch(e){}this.pending.delete(c.requestId),e.reject(Error(c&&c.error||"Worker error"))}}}},this.worker=e}async process(e,t,a,r){if(this.init(),!this.worker)throw Error("Worker not available");this.cancel();let l=Math.random().toString(36).slice(2),s=new Promise((e,t)=>{this.pending.set(l,{resolve:e,reject:t,events:a})});return this.worker.postMessage({type:"process",imageData:e,params:t,options:r,requestId:l},[e.data.buffer]),s}cancel(){var e;for(let[t,a]of(null==(e=this.worker)||e.postMessage({type:"cancel"}),this.pending)){try{a.reject(Error("Operation cancelled"))}catch(e){}this.pending.delete(t)}}dispose(){if(this.worker){try{this.worker.postMessage({type:"dispose"})}catch(e){}this.worker.terminate()}this.worker=null}constructor(){this.worker=null,this.pending=new Map}}function x(e){return e<0?0:e>1?1:e}function g(e,t){var a,r,l,s;let n=e.width,i=e.height;if(!t||!1===t.enabled)return new ImageData(new Uint8ClampedArray(e.data),n,i);let o=new Uint8ClampedArray(e.data),d=null!=(a=t.vibrance)?a:0;Math.abs(d)>1e-6&&function(e,t,a,r){if(1e-6>Math.abs(r))return;let l=Math.max(-1,Math.min(1,r));for(let t=0;t<e.length;t+=4){let a=e[t]/255,{h:r,s:s,l:n}=function(e,t,a){let r=Math.max(e,t,a),l=Math.min(e,t,a),s=0,n=0,i=(r+l)/2;if(r!==l){let o=r-l;switch(n=i>.5?o/(2-r-l):o/(r+l),r){case e:s=(t-a)/o+6*(t<a);break;case t:s=(a-e)/o+2;break;case a:s=(e-t)/o+4}s/=6}return{h:s,s:n,l:i}}(a,e[t+1]/255,e[t+2]/255),i=s;l>=0?i+=l*(1-i):i+=l*i;let{r:o,g:d,b:u}=function(e,t,a){let r,l,s;if(0===t)r=l=s=a;else{let n=(e,t,a)=>(a<0&&(a+=1),a>1&&(a-=1),a<1/6)?e+(t-e)*6*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e,i=a<.5?a*(1+t):a+t-a*t,o=2*a-i;r=n(o,i,e+1/3),l=n(o,i,e),s=n(o,i,e-1/3)}return{r,g:l,b:s}}(r,i=x(i),n);e[t]=Math.round(255*x(o)),e[t+1]=Math.round(255*x(d)),e[t+2]=Math.round(255*x(u))}}(o,0,0,d);let u=null!=(r=t.unsharpAmount)?r:0,c=null!=(l=t.unsharpRadius)?l:0,h=null!=(s=t.unsharpThreshold)?s:0;return u>1e-6&&c>0&&function(e,t,a,r,l,s){let n=Math.max(0,r);if(n<=1e-6||l<=0)return;let i=Math.max(0,Math.min(1,s)),o=new Float32Array(t*a);for(let t=0,a=0;t<e.length;t+=4,a++){let r=e[t]/255,l=e[t+1]/255,s=e[t+2]/255;o[a]=.2126*r+.7152*l+.0722*s}let d=function(e,t,a,r){if(r<=0)return e.slice();let l=Math.max(1,Math.floor(r)),s=2*l+1,n=new Float32Array(t*a),i=new Float32Array(t*a);for(let r=0;r<a;r++){let a=0;for(let s=-l;s<=l;s++){let l=Math.min(t-1,Math.max(0,s));a+=e[r*t+l]}for(let i=0;i<t;i++){n[r*t+i]=a/s;let o=Math.min(t-1,Math.max(0,i-l)),d=Math.min(t-1,Math.max(0,i+l+1));a+=e[r*t+d]-e[r*t+o]}}for(let e=0;e<t;e++){let r=0;for(let s=-l;s<=l;s++)r+=n[Math.min(a-1,Math.max(0,s))*t+e];for(let o=0;o<a;o++){i[o*t+e]=r/s;let d=Math.min(a-1,Math.max(0,o-l));r+=n[Math.min(a-1,Math.max(0,o+l+1))*t+e]-n[d*t+e]}}return i}(o,t,a,Math.max(1,Math.floor(l)));for(let r=0;r<a;r++)for(let a=0;a<t;a++){let l=r*t+a,s=4*l,u=o[l],c=u-d[l];i>0&&Math.abs(c)<i&&(c=0);let h=x(u+n*c)/(u+1e-6),m=x(e[s]/255*h),g=x(e[s+1]/255*h),p=x(e[s+2]/255*h);e[s]=Math.round(255*m),e[s+1]=Math.round(255*g),e[s+2]=Math.round(255*p)}}(o,n,i,u,c,h),new ImageData(o,n,i)}function p(){var e,t,a,c,x,p,b,f,y,v,w,j,M,k,S,N,C,z,R,E;let[q,D]=(0,l.useState)(null),[P,T]=(0,l.useState)(null),[A,I]=(0,l.useState)(null),[L,U]=(0,l.useState)(null),[F,W]=(0,l.useState)(null),[O,B]=(0,l.useState)(1),[H,G]=(0,l.useState)(!1),[J,_]=(0,l.useState)(0),[K,V]=(0,l.useState)(!0),[X,Y]=(0,l.useState)(null),[Q,$]=(0,l.useState)([]),[Z,ee]=(0,l.useState)(-1),et=(0,l.useRef)(null),[ea,er]=(0,l.useState)(u),[el,es]=(0,l.useState)({enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1.05,brightness:1,warmth:0,tint:0}),[en,ei]=(0,l.useState)(512),[eo,ed]=(0,l.useState)(1536),[eu,ec]=(0,l.useState)(!1),[eh,em]=(0,l.useState)(512),[ex,eg]=(0,l.useState)("area"),[ep,eb]=(0,l.useState)(360),[ef,ey]=(0,l.useState)(null),[ev,ew]=(0,l.useState)(null),[ej,eM]=(0,l.useState)(null),[ek,eS]=(0,l.useState)(null),[eN,eC]=(0,l.useState)({enabled:!0,vibrance:.1,unsharpAmount:.2,unsharpRadius:1,unsharpThreshold:.02}),[ez,eR]=(0,l.useState)(null),eE=(0,l.useRef)(null),eq=(0,l.useRef)(null),eD=(0,l.useRef)(0),[eP,eT]=(0,l.useState)(!1),[eA,eI]=(0,l.useState)(!1),[eL,eU]=(0,l.useState)(!1),[eF,eW]=(0,l.useState)(null),[eO,eB]=(0,l.useState)(!1),eH=(0,l.useCallback)(()=>{var e,t;return{img:null!=q?q:null,mode:ex,params:ea,pp:el,post:eN,minShortSide:en,maxShortSide:eo,area:"area"===ex?{cx:null!=(e=null==ef?void 0:ef.x)?e:null,cy:null!=(t=null==ef?void 0:ef.y)?t:null,size:ep}:null,perf:{stabilityMode:eu,tileSizePx:eh}}},[ea,el,eN,ex,q,en,eo,ef,ep,eu,eh]);(0,l.useEffect)(()=>(eq.current=new m,()=>{var e;return null==(e=eq.current)?void 0:e.dispose()}),[]);let eG=e=>{try{var t;null==(t=eq.current)||t.cancel()}catch(e){}T(null),W(null),I(null),U(null),ey(null),ew(null),eM(null),eS(null),eR(null),D(e),eU(!1),eI(!1),eW(null),eB(!1);let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let e=a.naturalWidth,t=a.naturalHeight,r=Math.max(8,Math.min(Math.floor(ep),Math.min(e,t))),l=Math.floor(r/2),s=Math.floor(e/2),n=Math.floor(t/2),i=Math.max(0,Math.min(s-l,e-r)),o=Math.max(0,Math.min(n-l,t-r));ey({x:s,y:n}),eR({left:i,top:o,size:r}),ew(null),eM(null),T(a)},a.src=e},eJ=(0,l.useCallback)(async()=>{var e,t,a,r,l,s,n,i,o,d,u;if(!P||!eq.current)return;let c=++eD.current;try{eq.current.cancel()}catch(e){}let h=(e=>{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;let a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw Error("2D context");return a.drawImage(e,0,0),a.getImageData(0,0,t.width,t.height)})(P),m=new ImageData(new Uint8ClampedArray(h.data),h.width,h.height);G(!0),_(1);try{let u=eu?{...ea,kernelSize:Math.min(ea.kernelSize,48),anisotropy:Math.min(ea.anisotropy,5),sectors:Math.min(null!=(e=ea.sectors)?e:6,4),order:Math.min(null!=(t=ea.order)?t:2,2),flowSigma:Math.min(null!=(a=ea.flowSigma)?a:2.4,2),radiusMaxScale:Math.min(null!=(r=ea.radiusMaxScale)?r:1.25,1.1),sigmaSpatial:Math.min(null!=(l=ea.sigmaSpatial)?l:.7,.8),sigmaRange:Math.max(.08,Math.min(null!=(s=ea.sigmaRange)?s:.12,.2)),quantizeLevels:Math.min(null!=(n=ea.quantizeLevels)?n:8,8),quantizeDither:Math.min(null!=(i=ea.quantizeDither)?i:.35,.35),edgeSigma:Math.min(null!=(o=ea.edgeSigma)?o:1,1),edgeMix:Math.min(null!=(d=ea.edgeMix)?d:.18,.2)}:ea;if("compare"===ex){let e=Math.min(h.width,h.height),t=1;t=e<en?Math.max(1,Math.ceil(en/Math.max(1,e))):eo>0&&e>eo?Math.max(.0625,eo/Math.max(1,e)):1,eD.current===c&&W(m);let a=await eq.current.process(h,{...u,upscaleFactor:Math.max(1,t),preserveSettings:!0},{onProgress:e=>{eD.current===c&&_(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{if(eD.current===c){Y(e),$(t=>[e,...t].slice(0,10));try{console.info("[Kuwahara Render Report]",e)}catch(e){}}}},{scale:t,preprocess:el,tileSize:eu?Math.min(eh,256):eh});eD.current===c&&(U(a),I(eN.enabled?g(a,eN):a),_(100),eU(!0),eI(!1),eW(eH())),eS(null)}else{let e=Math.max(8,Math.min(Math.floor(ep),h.width,h.height)),t=null!=ef?ef:{x:Math.floor(h.width/2),y:Math.floor(h.height/2)},a=Math.floor(e/2),r=Math.max(0,Math.min(t.x-a,h.width-e)),l=Math.max(0,Math.min(t.y-a,h.height-e)),s=document.createElement("canvas");s.width=h.width,s.height=h.height;let n=s.getContext("2d",{willReadFrequently:!0});if(!n)throw Error("2D context");n.putImageData(h,0,0);let i=document.createElement("canvas");i.width=e,i.height=e;let o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw Error("2D context");o.drawImage(s,r,l,e,e,0,0,e,e);let d=o.getImageData(0,0,e,e);if(eD.current!==c)return;ey(t),eR({left:r,top:l,size:e});let m=new ImageData(new Uint8ClampedArray(d.data),d.width,d.height);ew(m),eM(null);let x=await eq.current.process(d,{...u,upscaleFactor:1,preserveSettings:!0},{onProgress:e=>{eD.current===c&&_(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{if(eD.current===c){Y(e),$(t=>[e,...t].slice(0,10));try{console.info("[Kuwahara Render Report]",e)}catch(e){}}}},{scale:1,preprocess:el,tileSize:eu?Math.min(eh,256):eh});eD.current===c&&(eS(x),eM(eN.enabled?g(x,eN):x),_(100),eU(!0),eI(!1),eW(eH()))}}catch(t){let e=(null==t?void 0:t.message)||String(t);if("Operation cancelled"!==e&&(console.error(t),/webgl|context lost|webgl2|exhausted|limits unavailable|failed to create webgl/i.test(e))){V(!1);try{null==(u=eq.current)||u.dispose()}catch(e){}}}finally{eD.current===c&&G(!1)}},[P,ea,en,eo,el,eu,ex,ep,ef,eh,eN,eH]),e_=(0,l.useCallback)(()=>{let e=eE.current;if(!e)return;let t=e.naturalWidth,a=e.naturalHeight;if(!t||!a)return;let r=Math.max(8,Math.min(Math.floor(ep),Math.min(t,a))),l=Math.floor(r/2),s=Math.floor(t/2),n=Math.floor(a/2),i=Math.max(0,Math.min(s-l,t-r)),o=Math.max(0,Math.min(n-l,a-r));ey({x:s,y:n}),eR({left:i,top:o,size:r}),ew(null),eM(null),T(e)},[ep]);return(0,l.useEffect)(()=>{if(P){try{var e;null==(e=eq.current)||e.cancel()}catch(e){}eJ()}},[P]),(0,l.useEffect)(()=>{if(P&&(eP||!eL)){try{var e;null==(e=eq.current)||e.cancel()}catch(e){}let t=setTimeout(()=>{eJ()},300);return()=>{clearTimeout(t);try{var e;null==(e=eq.current)||e.cancel()}catch(e){}}}},[ea,el,en,eo,ex,eP,eJ,eL,P]),(0,l.useEffect)(()=>{if(P&&(eP||!eL)){try{var e;null==(e=eq.current)||e.cancel()}catch(e){}let t=setTimeout(()=>{eJ()},150);return()=>{clearTimeout(t);try{var e;null==(e=eq.current)||e.cancel()}catch(e){}}}},[ef,ep,eP,eJ,eL,P]),(0,l.useEffect)(()=>{if(!P)return},[eu,eh,P]),(0,l.useEffect)(()=>{var e;if(!L)return;let t=eP||!eL?eN:null!=(e=null==eF?void 0:eF.post)?e:eN;I((null==t?void 0:t.enabled)?g(L,t):L)},[L,eP,eL,eF,eN]),(0,l.useEffect)(()=>{var e;if(!ek)return;let t=eP||!eL?eN:null!=(e=null==eF?void 0:eF.post)?e:eN;eM((null==t?void 0:t.enabled)?g(ek,t):ek)},[ek,eP,eL,eF,eN]),(0,l.useEffect)(()=>{(!eL||eP)&&(L&&I(eN.enabled?g(L,eN):L),ek&&eM(eN.enabled?g(ek,eN):ek))},[eN]),(0,l.useEffect)(()=>{if(!eL||H||!eF){eI(!1),eB(!1);return}let e=!((e,t)=>{try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(eH(),eF);eI(e),e&&!eP&&eB(!0),e||eB(!1)},[eL,H,eP,eF,eH]),(0,l.useEffect)(()=>{H&&eO&&eB(!1)},[H,eO]),(0,r.jsxs)("div",{className:"flex h-screen text-gray-900 dark:text-gray-100",children:[(0,r.jsxs)("aside",{className:"w-[340px] max-h-full shrink-0 dark:border-gray-800 p-4 space-y-6 overflow-y-auto",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"w-full block text-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer text-xs",children:["Upload",(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(e=>{let t=new FileReader;t.onload=()=>eG(String(t.result)),t.readAsDataURL(e)})(a)}})]}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:h.map(e=>{let t=q===e.src;return(0,r.jsx)("button",{onClick:()=>(e=>{let t=d[e.presetIdx];if(er(e=>({...e,...t.params})),t.preprocess){let e=t.preprocess;es(t=>{var a,r,l,s,n,i,o,d;return{...t,enabled:null==(a=e.enabled)||a,blurEnabled:null==(r=e.blurEnabled)||r,blurRadius:null!=(l=e.blurRadius)?l:t.blurRadius,blurAmount:null!=(s=e.blurAmount)?s:t.blurAmount,saturation:null!=(n=e.saturation)?n:t.saturation,brightness:null!=(i=e.brightness)?i:t.brightness,warmth:null!=(o=e.warmth)?o:t.warmth,tint:null!=(d=e.tint)?d:t.tint}})}eG(e.src)})(e),className:"relative aspect-square rounded overflow-hidden border focus:outline-none "+(t?"ring-2 ring-blue-500 border-blue-500":"border-gray-300 dark:border-gray-700 hover:border-blue-400 dark:hover:outline-blue-400"),"aria-pressed":t,children:(0,r.jsx)("img",{src:e.src,alt:e.name,loading:"lazy",className:"w-full h-full object-cover"})},e.src)})})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Presets"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:d.map(e=>(0,r.jsx)("button",{className:"px-2 py-2 text-xs rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-200/60 dark:hover:bg-gray-700/60",onClick:()=>{er(t=>({...t,...e.params})),e.preprocess&&es(t=>{var a,r,l,s,n,i,o,d;return{...t,enabled:null==(a=e.preprocess.enabled)||a,blurEnabled:null==(r=e.preprocess.blurEnabled)||r,blurRadius:null!=(l=e.preprocess.blurRadius)?l:t.blurRadius,blurAmount:null!=(s=e.preprocess.blurAmount)?s:t.blurAmount,saturation:null!=(n=e.preprocess.saturation)?n:t.saturation,brightness:null!=(i=e.preprocess.brightness)?i:t.brightness,warmth:null!=(o=e.preprocess.warmth)?o:t.warmth,tint:null!=(d=e.preprocess.tint)?d:t.tint}})},children:e.name},e.name))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Output & Performance"}),(0,r.jsx)(n,{label:"Min short side (px)",value:en,min:256,max:8192,step:64,subtitle:"Upscales the short image edge (higher = more detail and time).",onChange:ei}),(0,r.jsx)(n,{label:"Max short side (px)",value:eo,min:512,max:8192,step:64,subtitle:"Downscales large images to fit (lower = faster).",onChange:ed}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eP,onChange:e=>{let t=e.target.checked;if(t&&eA&&eL&&!H){eB(!0);try{var a;null==(a=eq.current)||a.cancel()}catch(e){}eJ()}eT(t)}})," ","Auto render on edit"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eu,onChange:e=>ec(e.target.checked)})," ","Stability mode"]}),(0,r.jsx)(n,{label:"Tile size (px)",value:eh,disabled:eu,min:128,max:2048,step:64,onChange:em}),(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Larger tiles are faster but use more GPU memory. Stability mode caps at 256. Applies on next render."}),(0,r.jsx)(n,{label:"Area size (px)",value:ep,min:64,max:1024,step:16,onChange:e=>eb(e)})]}),(0,r.jsxs)("details",{className:"space-y-4",open:!0,children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Style"}),(0,r.jsx)(n,{label:"Brush size",value:ea.kernelSize,min:1,max:200,step:1,subtitle:"Approximate stroke size (larger = broader strokes).",onChange:e=>er(t=>({...t,kernelSize:e}))}),(0,r.jsx)(n,{label:"Directionality",value:ea.anisotropy,min:1,max:8,step:.1,subtitle:"Align strokes with local structure (higher = more aligned).",onChange:e=>er(t=>({...t,anisotropy:e}))}),(0,r.jsx)(n,{label:"Sharpness",value:ea.sharpness,min:1,max:10,step:.1,subtitle:"Local contrast within strokes (higher = crisper).",onChange:e=>er(t=>({...t,sharpness:e}))}),(0,r.jsx)(n,{label:"Stylization",value:ea.alpha,min:.1,max:2,step:.05,subtitle:"Strength of abstraction vs. fidelity.",onChange:e=>er(t=>({...t,alpha:e}))}),(0,r.jsx)(n,{label:"Edge preservation",value:ea.threshold,min:.01,max:1,step:.01,subtitle:"Preserve edges across regions (higher = fewer bleeds).",onChange:e=>er(t=>({...t,threshold:e}))}),(0,r.jsx)(n,{label:"Levels",value:null!=(e=ea.quantizeLevels)?e:0,min:0,max:64,step:1,subtitle:"Posterize to N color bands.",onChange:e=>er(t=>({...t,quantizeLevels:e}))}),(0,r.jsx)(n,{label:"Strength",value:null!=(t=ea.quantizeStrength)?t:.6,min:0,max:1,step:.05,subtitle:"Blend toward posterized colors (0 = off).",onChange:e=>er(t=>({...t,quantizeStrength:e}))}),(0,r.jsx)(n,{label:"Dither",value:null!=(a=ea.quantizeDither)?a:.35,min:0,max:1,step:.05,subtitle:"Add fine noise to reduce visible banding.",onChange:e=>er(t=>({...t,quantizeDither:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Pre‑render"}),(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 leading-4",children:"Runs before the painterly filter. Reduces small noise and JPEG artifacts while preserving edges; helps stability at high upscales."}),(0,r.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:el.enabled,onChange:e=>es({...el,enabled:e.target.checked})})," ","Enable pre‑render"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:el.blurEnabled,onChange:e=>es({...el,blurEnabled:e.target.checked}),disabled:!el.enabled})," ","Edge-aware smoothing"]})]}),(0,r.jsx)(n,{label:"Blur radius",value:el.blurRadius,min:0,max:16,step:1,subtitle:"Kernel size in pixels (higher softens more, pair with low amount).",onChange:e=>es({...el,blurRadius:e}),disabled:!el.enabled||!el.blurEnabled}),(0,r.jsx)(n,{label:"Blur amount",value:el.blurAmount,min:0,max:1,step:.05,subtitle:"Mix strength in flat regions (edges are preserved).",onChange:e=>es({...el,blurAmount:e}),disabled:!el.enabled||!el.blurEnabled}),(0,r.jsx)(n,{label:"Saturation",value:el.saturation,min:0,max:2,step:.05,subtitle:"Global color intensity before stylizing.",onChange:e=>es({...el,saturation:e}),disabled:!el.enabled}),(0,r.jsx)(n,{label:"Brightness",value:el.brightness,min:0,max:2,step:.05,subtitle:"Global brightness multiplier before stylizing.",onChange:e=>es({...el,brightness:e}),disabled:!el.enabled}),(0,r.jsx)(n,{label:"Warmth",value:el.warmth,min:-1,max:1,step:.05,subtitle:"Bias reds vs blues (positive = warmer).",onChange:e=>es({...el,warmth:e}),disabled:!el.enabled}),(0,r.jsx)(n,{label:"Tint",value:el.tint,min:-1,max:1,step:.05,subtitle:"Bias green vs magenta before stylizing.",onChange:e=>es({...el,tint:e}),disabled:!el.enabled})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Post‑render"}),(0,r.jsx)("div",{className:"flex flex-col space-y-4",children:(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!eN.enabled,onChange:e=>eC({...eN,enabled:e.target.checked})})," ","Enable"]})}),(0,r.jsx)(n,{label:"Vibrance",value:null!=(c=eN.vibrance)?c:0,min:-1,max:1,step:.05,subtitle:"Boost muted colors while protecting already saturated ones.",onChange:e=>eC({...eN,vibrance:e}),disabled:!eN.enabled}),(0,r.jsx)(n,{label:"Unsharp amount",value:null!=(x=eN.unsharpAmount)?x:0,min:0,max:2,step:.05,subtitle:"Detail boost strength after render.",onChange:e=>eC({...eN,unsharpAmount:e}),disabled:!eN.enabled}),(0,r.jsx)(n,{label:"Unsharp radius",value:null!=(p=eN.unsharpRadius)?p:0,min:0,max:8,step:1,subtitle:"Blur radius for mask (small = crisp, large = broad clarity).",onChange:e=>eC({...eN,unsharpRadius:e}),disabled:!eN.enabled}),(0,r.jsx)(n,{label:"Unsharp threshold",value:null!=(b=eN.unsharpThreshold)?b:0,min:0,max:.25,step:.005,subtitle:"Protect flat areas from sharpening (higher = safer).",onChange:e=>eC({...eN,unsharpThreshold:e}),disabled:!eN.enabled})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Stroke & coherence"}),(0,r.jsx)(n,{label:"Sectors",value:null!=(f=ea.sectors)?f:6,min:1,max:8,step:1,subtitle:"Number of stroke directions (more = smoother, slower).",onChange:e=>er(t=>({...t,sectors:e}))}),(0,r.jsx)(n,{label:"Contrast blend (p)",value:null!=(y=ea.order)?y:1,min:0,max:6,step:.5,subtitle:"Aggressiveness when picking a dominant direction.",onChange:e=>er(t=>({...t,order:e}))}),(0,r.jsx)(n,{label:"Flow scale",value:null!=(v=ea.flowSigma)?v:2,min:0,max:6,step:.5,subtitle:"Neighborhood size for structure (higher = longer strokes).",onChange:e=>er(t=>({...t,flowSigma:e}))}),(0,r.jsx)(n,{label:"Adaptive",value:null!=(w=ea.adaptStrength)?w:.75,min:0,max:1,step:.05,subtitle:"Vary stroke size by detail (pairs with Min/Max brush).",onChange:e=>er(t=>({...t,adaptStrength:e}))}),(0,r.jsx)(n,{label:"Min brush",value:null!=(j=ea.radiusMinScale)?j:.35,min:.1,max:1,step:.05,subtitle:"Lower bound for adaptive stroke size.",onChange:e=>er(t=>({...t,radiusMinScale:e}))}),(0,r.jsx)(n,{label:"Max brush",value:null!=(M=ea.radiusMaxScale)?M:1,min:.5,max:1.5,step:.05,subtitle:"Upper bound for adaptive stroke size.",onChange:e=>er(t=>({...t,radiusMaxScale:e}))}),(0,r.jsx)(n,{label:"Local softness",value:null!=(k=ea.sigmaSpatial)?k:.5,min:.1,max:1.5,step:.05,subtitle:"Softness within a sector (higher = smoother, less texture).",onChange:e=>er(t=>({...t,sigmaSpatial:e}))}),(0,r.jsx)(n,{label:"Color edge sens.",value:null!=(S=ea.sigmaRange)?S:.15,min:.01,max:.5,step:.01,subtitle:"Sensitivity to color changes (lower = more edge-preserving).",onChange:e=>er(t=>({...t,sigmaRange:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Ink outlines"}),(0,r.jsx)(n,{label:"Ink sigma",value:null!=(N=ea.edgeSigma)?N:0,min:.1,max:3,step:.1,subtitle:"Edge scale (blur radius) used to detect lines.",onChange:e=>er(t=>({...t,edgeSigma:e}))}),(0,r.jsx)(n,{label:"Ink threshold (τ)",value:null!=(C=ea.edgeTau)?C:0,min:.001,max:.02,step:.001,subtitle:"Lower finds more lines (higher suppresses weak lines).",onChange:e=>er(t=>({...t,edgeTau:e}))}),(0,r.jsx)(n,{label:"Ink slope (φ)",value:null!=(z=ea.edgePhi)?z:10,min:1,max:20,step:1,subtitle:"Line steepness/contrast.",onChange:e=>er(t=>({...t,edgePhi:e}))}),(0,r.jsx)(n,{label:"Ink mix",value:null!=(R=ea.edgeMix)?R:0,min:0,max:1,step:.05,subtitle:"How much ink overlay to add to the painting.",onChange:e=>er(t=>({...t,edgeMix:e}))})]})]}),(0,r.jsxs)("main",{className:"flex flex-col flex-1 p-4",children:[(0,r.jsxs)("div",{className:"flex-none flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mr-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("area"===ex?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>eg("area"),children:"Area Preview"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("compare"===ex?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>eg("compare"),children:"Full Preview"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>B(e=>Math.max(.25,e-.25)),children:"−"}),(0,r.jsxs)("span",{className:"text-xs w-16 text-center",children:[Math.round(100*O),"%"]}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>B(e=>Math.min(4,e+.25)),children:"+"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>B(1),children:"Reset"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700 disabled:opacity-50",disabled:!A||H,onClick:()=>{if(!A)return;let e=document.createElement("canvas");e.width=A.width,e.height=A.height;let t=e.getContext("2d");t&&(t.putImageData(A,0,0),e.toBlob(e=>{if(!e)return;let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="kuwahara-".concat(Date.now(),".png"),a.click(),setTimeout(()=>{try{URL.revokeObjectURL(t)}catch(e){}},0)},"image/png"))},children:"Download PNG"})]})]}),(0,r.jsxs)("div",{className:"relative flex-1 flex flex-col justify-center bg-gray-200 dark:bg-gray-800 rounded-xl min-h-[360px]",children:[(0,r.jsxs)("div",{className:"flex-none max-h-full overflow-y-auto p-4",children:[!q&&(0,r.jsx)("div",{className:"h-[480px] flex items-center justify-center text-sm text-gray-500",children:"No image loaded"}),q&&"compare"===ex&&F&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{className:"w-full",labels:{before:"Before",after:K?H||!A?"Previewing…":"After":"GPU unavailable"},before:(0,r.jsx)(i,{imageData:F,zoom:O}),after:H||!A?(0,r.jsx)(i,{imageData:F,zoom:O,cssFilter:"blur(8px)"}):(0,r.jsx)(i,{imageData:A,zoom:O})}),H&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[J,"%"]})]}),q&&"area"===ex&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsxs)("div",{className:"relative overflow-clip inline-block max-w-full",style:{maxWidth:"400px",maxHeight:"400px"},children:[(0,r.jsx)("img",{ref:eE,src:q,alt:"original",crossOrigin:"anonymous",className:"max-w-full h-auto rounded",onClick:e=>{if(!P||!eE.current)return;let t=eE.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,l=P.naturalWidth/Math.max(1,t.width),s=P.naturalHeight/Math.max(1,t.height),n=Math.floor(a*l),i=Math.floor(r*s),o=Math.max(8,Math.min(ep,Math.min(P.naturalWidth,P.naturalHeight))),d=Math.floor(o/2),u=Math.max(d,Math.min(n,P.naturalWidth-d)),c=Math.max(d,Math.min(i,P.naturalHeight-d));ey({x:u,y:c}),eR({left:Math.max(0,Math.min(u-d,P.naturalWidth-o)),top:Math.max(0,Math.min(c-d,P.naturalHeight-o)),size:o})},onLoad:e_}),P&&(0,r.jsx)(o,{imageEl:eE.current,naturalWidth:P.naturalWidth,naturalHeight:P.naturalHeight,areaCenter:ef,areaSize:ep,areaAfter:ej,isBusy:H,areaCrop:ez})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-4xl mx-auto",children:[(0,r.jsx)("div",{className:"aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:ev?(0,r.jsx)(i,{imageData:ev,zoom:1}):(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Pick a point"})}),(0,r.jsxs)("div",{className:"relative aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:[H&&ev&&!ej&&(0,r.jsx)(i,{imageData:ev,zoom:1,cssFilter:"blur(8px)"}),ej&&(0,r.jsx)(i,{imageData:ej,zoom:1}),H&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[J,"%"]})]})]})]})]}),eL&&!H&&(eA&&!eP||eO)&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"px-4 py-3 rounded-md bg-black/60 text-white text-xs flex items-center gap-3 shadow-lg",children:[(0,r.jsx)("span",{children:"Settings changed. Re-render now?"}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-white/40 bg-white/10 hover:bg-white/20",onClick:()=>{try{var e;null==(e=eq.current)||e.cancel()}catch(e){}eI(!1),eB(!1),eJ()},children:"Re-render"})]})}),!K&&(0,r.jsxs)("div",{className:"absolute left-4 bottom-4 right-4 sm:right-auto sm:max-w-xl text-xs px-3 py-2 rounded bg-yellow-200/90 text-yellow-900 dark:bg-yellow-500/20 dark:text-yellow-200 border border-yellow-400/60 flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{children:"GPU/WebGL became unavailable. Results are limited. Try retrying or reloading."}),X&&(0,r.jsxs)("div",{className:"mt-1 text-[11px] text-yellow-900/90 dark:text-yellow-200/80",children:[(0,r.jsxs)("span",{className:"mr-2",children:["Failed step: ",(0,r.jsx)("b",{children:null!=(E=X.failedStep)?E:"—"})]}),!!(X.errors&&X.errors.length)&&(0,r.jsxs)("span",{className:"mr-2",children:["Error:"," ","".concat(X.errors[0].where,":").concat(X.errors[0].label)]}),X.vendor&&X.renderer&&(0,r.jsxs)("span",{className:"mr-2",children:["GPU: ",X.vendor," \xb7 ",X.renderer]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:()=>{try{var e;null==(e=et.current)||e.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}},title:"Scroll to diagnostics",children:"Details"}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(X,null,2))}catch(e){}},title:"Copy report JSON",children:"Copy report"})]}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/60 dark:bg-white/10",onClick:()=>{V(!0);try{var e;null==(e=eq.current)||e.dispose()}catch(e){}eq.current=new m;try{eJ()}catch(e){}},children:"Retry"})]})]})]}),(0,r.jsxs)("div",{ref:et,className:"mt-3 text-[11px] leading-5 bg-white/70 dark:bg-black/30 backdrop-blur rounded border border-gray-300 dark:border-gray-700 p-3 max-w-full overflow-x-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Render Diagnostics"}),(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-300",children:X?"Latest report":"No render yet"})]}),(0,r.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[10px] text-gray-500",children:"History:"}),0===Q.length&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400",children:"—"}),Q.map((e,t)=>{var a,l,s,n,i;return(0,r.jsxs)("button",{className:"px-2 py-0.5 rounded border text-[10px] ".concat(t===Z?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>ee(t===Z?-1:t),title:"Select report ".concat(t+1),children:[null!=(l=e.mode)?l:"fast","/",Math.round(null!=(n=null!=(s=e.durationMs)?s:null==(a=e.worker)?void 0:a.overallMs)?n:0),"ms"]},(null!=(i=e.requestId)?i:"")+"-"+t)}),Q.length>0&&(0,r.jsx)("button",{className:"ml-2 px-2 py-0.5 rounded border text-[10px] border-gray-300 dark:border-gray-700",onClick:()=>{$([]),ee(-1)},children:"Clear"})]}),(()=>{var e,t,a,l,s,n,i,o,d,u,c,h,m;let x=Z>=0?Q[Z]:X;return x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Mode:"})," ",x.mode]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Failed step:"})," ",null!=(t=x.failedStep)?t:"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Duration:"})," ",Math.round(null!=(l=null!=(a=x.durationMs)?a:null==(e=x.worker)?void 0:e.overallMs)?l:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"GPU time:"})," ",x.gpuTimeNs?"".concat(Math.round(x.gpuTimeNs/1e6)," ms"):"—"," ",x.gpuDisjoint?"(disjoint)":""]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Original:"})," ",x.originalSize?"".concat(x.originalSize.w,"\xd7").concat(x.originalSize.h):"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Target:"})," ",x.targetSize?"".concat(x.targetSize.w,"\xd7").concat(x.targetSize.h):"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Vendor:"})," ",null!=(s=x.vendor)?s:"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Renderer:"})," ",null!=(n=x.renderer)?n:"—"]})]}),!!(x.errors&&x.errors.length)&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Errors:"})," ",x.errors.map(e=>"".concat(e.where,":").concat(e.label)).join(", ")]}),!!(x.notes&&x.notes.length)&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Notes"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1",children:x.notes.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),x.worker&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Worker metrics"}),(0,r.jsxs)("div",{className:"mt-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Canceled:"})," ",x.worker.canceled?"yes":"no"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Retries:"})," ",null!=(i=x.worker.retries)?i:0]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Pre‑render:"})," ",Math.round(null!=(o=x.worker.preprocessMs)?o:0)," ms"]}),x.worker.tiling&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles:"})," ",x.worker.tiling.tilesX,"\xd7",x.worker.tiling.tilesY," ","(",x.worker.tiling.totalTiles,") @"," ",x.worker.tiling.tileSize]}),x.worker.aggregates&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles total:"})," ",Math.round(null!=(d=x.worker.aggregates.tilesTotalMs)?d:0)," ","ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Avg / tile:"})," ",Math.round(null!=(u=x.worker.aggregates.tileAvgMs)?u:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Max tile:"})," ",Math.round(null!=(c=x.worker.aggregates.tileMaxMs)?c:0)," ","ms (#",(null!=(h=x.worker.aggregates.tileMaxIndex)?h:0)+1,")"]})]})]}),x.worker.tiles&&x.worker.tiles.length>0&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Per-tile timings"}),(0,r.jsx)("div",{className:"mt-1 max-h-64 overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-[10px]",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-gray-500",children:[(0,r.jsx)("th",{className:"text-left",children:"Tile"}),(0,r.jsx)("th",{className:"text-right",children:"Crop"}),(0,r.jsx)("th",{className:"text-right",children:"GPU"}),(0,r.jsx)("th",{className:"text-right",children:"Compose"}),(0,r.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,r.jsx)("tbody",{children:x.worker.tiles.map((e,t)=>{var a,l,s,n,i;return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{children:["(",e.tx,",",e.ty,") ",e.wOut,"\xd7",e.hOut]}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(l=e.cropMs)?l:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(s=null==(a=e.gpu)?void 0:a.totalMs)?s:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(n=e.composeMs)?n:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(i=e.totalMs)?i:0)})]},t)})})]})})]})]}),(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Uniforms"}),(0,r.jsx)("pre",{className:"mt-1 text-[10px] whitespace-pre-wrap break-all",children:JSON.stringify(null!=(m=x.uniforms)?m:{},null,2)})]})]}):(0,r.jsx)("div",{className:"mt-2 text-[10px] text-gray-600 dark:text-gray-300",children:"Run a render to see diagnostics here."})})()]})]})]})}},5697:(e,t,a)=>{Promise.resolve().then(a.bind(a,3100))}},e=>{e.O(0,[623,358],()=>e(e.s=5697)),_N_E=e.O()}]);