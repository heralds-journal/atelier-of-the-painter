(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3100:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(5155),l=a(2115);function s(e){let{before:t,after:a,initialPosition:s=.42,className:n,labels:i}=e,o=(0,l.useRef)(null),[d,c]=(0,l.useState)(()=>Math.max(0,Math.min(1,s))),[u,h]=(0,l.useState)(!1),m=(0,l.useCallback)(e=>{if(!u||!o.current)return;let t=o.current.getBoundingClientRect();c(Math.max(0,Math.min(1,(e.clientX-t.left)/Math.max(1,t.width))))},[u]);(0,l.useEffect)(()=>{let e=()=>h(!1),t=e=>m(e);return window.addEventListener("pointerup",e),window.addEventListener("pointermove",t),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointermove",t)}},[m]);let x=Math.round((1-d)*100);return(0,r.jsxs)("div",{ref:o,className:"relative select-none overflow-hidden rounded-lg group "+(null!=n?n:""),role:"group","aria-label":"Before/After comparison",children:[(0,r.jsx)("div",{className:"relative z-0",children:a}),(0,r.jsx)("div",{className:"absolute inset-0",style:{clipPath:"inset(0% ".concat(x,"% 0% 0%)"),WebkitClipPath:"inset(0% ".concat(x,"% 0% 0%)")},"aria-hidden":!0,children:(0,r.jsx)("div",{className:"absolute inset-0",children:t})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-white/40 dark:bg-white/30 shadow pointer-events-none transition-opacity duration-150 group-hover:bg-white/80 dark:group-hover:bg-white/60",style:{left:"".concat(Math.round(100*d),"%")}}),(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2",style:{left:"".concat(Math.round(100*d),"%")},children:(0,r.jsx)("div",{className:"h-10 w-6 rounded bg-white/90 dark:bg-gray-200 text-gray-700 flex items-center justify-center shadow opacity-0 group-hover:opacity-100 transition-opacity duration-150 cursor-col-resize",onPointerDown:e=>{h(!0);try{e.currentTarget.setPointerCapture(e.pointerId)}catch(e){}},role:"slider","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":Number(d.toFixed(2)),"aria-label":"Comparison handle",children:(0,r.jsx)("span",{className:"text-xs",children:"↔"})})}),(null==i?void 0:i.before)&&(0,r.jsx)("div",{className:"absolute left-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.before}),(null==i?void 0:i.after)&&(0,r.jsx)("div",{className:"absolute right-2 top-2 text-xs px-2 py-1 rounded bg-black/50 text-white",children:i.after})]})}function n(e){let{label:t,value:a,min:s,max:n,step:i=1,onChange:o,inputWidthPx:d=72,disabled:c,subtitle:u}=e,[h,m]=(0,l.useState)(String(a)),x=(0,l.useRef)(null);(0,l.useEffect)(()=>{document.activeElement!==x.current&&m(String(a))},[a]);let g=e=>Math.max(s,Math.min(n,e));return(0,r.jsxs)("div",{className:"space-y-1 "+(c?"opacity-60":""),"aria-disabled":c,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs "+(c?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"),children:t}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=g(a-i);o(e),m(String(e))},disabled:c,"aria-label":"Decrement ".concat(t),children:"−"}),(0,r.jsx)("input",{type:"number",className:"px-1 py-0.5 bg-gray-50 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 text-xs disabled:opacity-60 disabled:cursor-not-allowed disabled:bg-gray-100 dark:disabled:bg-gray-800",style:{width:d},ref:x,value:h,min:s,max:n,step:i,onChange:e=>m(e.target.value),onBlur:()=>{let e=parseFloat(h);if(isNaN(e))return void m(String(a));let t=g(e);t!==a&&o(t),m(String(t))},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),"Escape"===e.key&&(m(String(a)),e.currentTarget.blur())},disabled:c,"aria-label":"".concat(t," value")}),(0,r.jsx)("button",{type:"button",className:"px-1 rounded border border-gray-300 dark:border-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{let e=g(a+i);o(e),m(String(e))},disabled:c,"aria-label":"Increment ".concat(t),children:"+"})]})]}),u&&(0,r.jsx)("div",{className:"text-[10px] leading-4 "+(c?"text-gray-400 dark:text-gray-500":"text-gray-500 dark:text-gray-400"),children:u}),(0,r.jsx)("input",{type:"range",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50",min:s,max:n,step:i,value:a,onChange:e=>{let t=g(Number(e.target.value));o(t),m(String(t))},disabled:c,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":a})]})}function i(e){let{imageData:t,zoom:a,cssFilter:s,className:n,style:i}=e,o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{let r=o.current;if(!r)return;let l=Math.max(1,Math.floor(t.width*Math.max(.01,a))),s=Math.max(1,Math.floor(t.height*Math.max(.01,a)));r.width=l,r.height=s;let n=r.getContext("2d");if(n)try{let a=await createImageBitmap(t);if(e){try{a.close()}catch(e){}return}n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.clearRect(0,0,l,s),n.drawImage(a,0,0,l,s);try{a.close()}catch(e){}}catch(r){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let a=e.getContext("2d");if(a)try{a.putImageData(t,0,0),n.drawImage(e,0,0,l,s)}catch(e){}}})(),()=>{e=!0}},[t,a]),(0,r.jsx)("canvas",{ref:o,className:null!=n?n:"block max-w-full h-auto mx-auto rounded",style:{...s?{filter:s}:{},...i||{}}})}function o(e){let{imageEl:t,naturalWidth:a,naturalHeight:s,areaCenter:n,areaSize:o,areaAfter:d,isBusy:c,areaCrop:u}=e,[h,m]=(0,l.useState)({w:0,h:0});if((0,l.useEffect)(()=>{if(!t)return;let e=new ResizeObserver(e=>{var a;let r=null==(a=e[0])?void 0:a.contentRect;r?m({w:Math.round(r.width),h:Math.round(r.height)}):m({w:t.clientWidth,h:t.clientHeight})});return m({w:t.clientWidth,h:t.clientHeight}),e.observe(t),()=>{try{e.disconnect()}catch(e){}}},[t]),!t||!n||0===h.w||0===h.h)return null;let x=h.w/Math.max(1,a),g=h.h/Math.max(1,s),p=u?u.size:Math.max(8,Math.min(Math.floor(o),Math.min(a,s))),b=Math.floor(p/2),f=u?u.left+b:Math.max(b,Math.min(n.x,a-b)),y=u?u.top+b:Math.max(b,Math.min(n.y,s-b)),v=u?u.left:f-b,w=u?u.top:y-b,j=Math.round(v*x),M=Math.round(w*g),k=Math.max(1,Math.round(p*x)),N=Math.max(1,Math.round(p*g));return(0,r.jsx)("div",{style:{position:"absolute",left:j,top:M,width:k,height:N,outline:"1px solid #fff5",pointerEvents:"none",overflow:"hidden"},children:!c&&d?(0,r.jsx)(i,{imageData:d,zoom:1,className:"block w-full h-full",style:{width:"100%",height:"100%"}}):null})}let d=[{name:"Oil Paint",params:{kernelSize:36,anisotropy:6.5,sharpness:6,alpha:1,threshold:.16,sectors:4,order:3.5,sigmaSpatial:4,sigmaRange:.3,adaptStrength:.9,radiusMinScale:.5,radiusMaxScale:1.1,flowSigma:2.4,quantizeLevels:64,quantizeStrength:.7,quantizeDither:.3,softTau:0,edgeSigma:1,edgeTau:.008,edgePhi:12,edgeMix:.18},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1.25,brightness:1,warmth:0,tint:0}},{name:"Watercolor",params:{kernelSize:26,anisotropy:5,sharpness:3.4,alpha:1,threshold:.18,sectors:4,order:1.5,sigmaSpatial:9,sigmaRange:.48,adaptStrength:.8,radiusMinScale:.4,radiusMaxScale:1.15,flowSigma:2,quantizeLevels:16,quantizeStrength:.5,quantizeDither:.35,softTau:.035,edgeSigma:.8,edgeTau:.008,edgePhi:10,edgeMix:.1},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.25,saturation:1.05,brightness:1,warmth:0,tint:0}},{name:"Soft Portrait",params:{kernelSize:20,anisotropy:5.5,sharpness:3.2,alpha:.95,threshold:.18,sectors:4,order:1,sigmaSpatial:8.5,sigmaRange:.42,adaptStrength:.8,radiusMinScale:.4,radiusMaxScale:1.15,flowSigma:2,quantizeLevels:64,quantizeStrength:.45,quantizeDither:.3,softTau:.03,edgeSigma:.9,edgeTau:.008,edgePhi:10,edgeMix:.12},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.18,saturation:1.05,brightness:1,warmth:0,tint:0}},{name:"Inked Poster",params:{kernelSize:30,anisotropy:6,sharpness:5,alpha:1,threshold:.18,sectors:4,order:3.6,sigmaSpatial:4.5,sigmaRange:.3,adaptStrength:.9,radiusMinScale:.45,radiusMaxScale:1.15,flowSigma:2.6,quantizeLevels:8,quantizeStrength:.65,quantizeDither:.35,softTau:0,edgeSigma:1,edgeTau:.008,edgePhi:12,edgeMix:.25},preprocess:{enabled:!0,blurEnabled:!0,blurRadius:2,blurAmount:.2,saturation:1,brightness:1,warmth:0,tint:0}}],c={kernelSize:28,anisotropy:6.5,sharpness:4.8,alpha:1,threshold:.18,upscaleFactor:1,preserveSettings:!0,...d[0]};function u(e){let t="/atelier-of-the-painter".replace(/\/$/,"");if(!e)return t||"/";let a=e.startsWith("/")?e:"/".concat(e);return"".concat(t).concat(a)||a}let h=[{name:"Sample 1",src:u("/gw669.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw063.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw103.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw435.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw226.jpg"),presetIdx:0},{name:"Sample 4",src:u("/gw754.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw537.jpg"),presetIdx:0},{name:"Sample 1",src:u("/gw522.jpg"),presetIdx:0}];class m{init(){if(this.worker)return;let e=new Worker(a.tu(new URL(a.p+a.u(63),a.b)),{type:void 0});e.postMessage({type:"init",width:256,height:256}),e.onmessage=e=>{var t,a,r,l,s,n,i,o,d,c,u;let h=e.data;if(h&&h.type)switch(h.type){case"progress":{let e=this.pending.get(h.requestId);if(e&&"number"==typeof h.progress){let l=Number(h.progress)||0,s=null!=(t=e._lastProgress)?t:-1/0,n=l-s,i=l>=1;(s===-1/0||i&&s<1||n>=.01)&&(null==(r=e.events)||null==(a=r.onProgress)||a.call(r,l),e._lastProgress=Math.min(l,1))}break}case"report":{let e=this.pending.get(h.requestId);if(e&&h.report){e._reported=!0,null==(s=e.events)||null==(l=s.onReport)||l.call(s,h.report);try{this.lastReport=h.report}catch(e){}}break}case"tile":{let e=this.pending.get(h.requestId);e&&"number"==typeof h.done&&"number"==typeof h.total&&(null==(i=e.events)||null==(n=i.onTile)||n.call(i,h.done,h.total));break}case"result":{let e=this.pending.get(h.requestId);if(e){try{h.report&&!e._reported&&(null==(d=e.events)||null==(o=d.onReport)||o.call(d,h.report),e._reported=!0),h.report&&(this.lastReport=h.report)}catch(e){}this.pending.delete(h.requestId),e.resolve(h.imageData)}break}case"error":{let e=h.requestId?this.pending.get(h.requestId):void 0;if(e){try{h.report&&!e._reported&&(null==(u=e.events)||null==(c=u.onReport)||c.call(u,h.report),e._reported=!0)}catch(e){}this.pending.delete(h.requestId),e.reject(Error(h&&h.error||"Worker error"))}}}},this.worker=e}recommendTileSize(e){var t,a;return"number"==typeof e&&e>0?e:((null==(a=this.lastReport)||null==(t=a.limits)?void 0:t.MAX_TEXTURE_SIZE)||0)>=8192?768:512}async process(e,t,a,r){if(this.init(),!this.worker)throw Error("Worker not available");this.cancel();let l=Math.random().toString(36).slice(2),s=new Promise((e,t)=>{this.pending.set(l,{resolve:e,reject:t,events:a})}),n=this.recommendTileSize(null==r?void 0:r.tileSize);return this.worker.postMessage({type:"process",imageData:e,params:t,options:{...r,tileSize:n},requestId:l},[e.data.buffer]),s}ensurePool(e){if(this.poolSize!==e||this.pool.length!==e){for(let e of this.pool)try{e.terminate()}catch(e){}this.pool=[],this.poolSize=e;for(let t=0;t<e;t++){let e=new Worker(a.tu(new URL(a.p+a.u(444),a.b)),{type:void 0});try{e.postMessage({type:"init",width:1,height:1})}catch(e){}this.pool.push(e)}}}async processPool(e,t,a,r){var l,s,n,i;let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;this.ensurePool(o);let d=this.recommendTileSize(null==r?void 0:r.tileSize),c=Math.max(.0625,Number(null!=(s=null==r?void 0:r.scale)?s:1)),u=Math.max(1,Math.floor(e.width*c)),h=Math.max(1,Math.floor(e.height*c)),m=Math.floor(h/o),x=[],g=Array(o).fill(0),p=e=>t=>{var r;g[e]=Math.min(Math.max(t,0),1);let l=g.reduce((e,t)=>e+t,0)/o;null==a||null==(r=a.onProgress)||r.call(a,l)},b=[];for(let t=0;t<o;t++)b.push(new ImageData(new Uint8ClampedArray(e.data),e.width,e.height));let f=[];for(let e=0;e<o;e++){let a=e*m,l=e===o-1?h-a:m,s={x:0,y:a,w:u,h:l};f.push(s);let n=Math.random().toString(36).slice(2),i=this.pool[e],c=new Promise((s,o)=>{let c=t=>{let a=t.data;if(a&&a.type)switch(a.type){case"progress":a.requestId===n&&p(e)(a.progress);break;case"report":break;case"result":if(a.requestId===n){i.removeEventListener("message",c);let t=a.report||void 0;t&&(this.lastReport=t);let r=(null==t?void 0:t.startedAt)||Date.now(),l=(null==t?void 0:t.finishedAt)||Date.now();s({idx:e,data:a.imageData,report:t,startedAt:r,finishedAt:l})}break;case"error":a.requestId===n&&(i.removeEventListener("message",c),o(Error(a.error||"Worker error")))}};i.addEventListener("message",c);let h=b[e];i.postMessage({type:"process",imageData:h,params:t,options:{...r,tileSize:d,partition:{x:0,y:a,w:u,h:l}},requestId:n},[h.data.buffer])});x.push(c)}let y=performance.now?performance.now():Date.now(),v=await Promise.all(x),w=new ImageData(u,h),j=0;for(let e=0;e<v.length;e++){let t=v[e].data,a=t.height;for(let e=0;e<a;e++){let a=e*t.width*4,r=(j+e)*u*4;w.data.set(t.data.subarray(a,a+4*t.width),r)}j+=a}let M=(performance.now?performance.now():Date.now())-y;null==a||null==(l=a.onProgress)||l.call(a,1);try{let e=v[v.length-1].report||(null==(n=v.find(e=>e.report))?void 0:n.report);if(e){let t=v.map((e,t)=>{var a,r;return{index:t,rect:f[t],durationMs:Math.max(0,(null!=(a=e.finishedAt)?a:0)-(null!=(r=e.startedAt)?r:0))}}),r={...e,parallel:{enabled:!0,poolSize:o,mergeMs:M,bands:t}};this.lastReport=r,null==a||null==(i=a.onReport)||i.call(a,r)}}catch(e){}return w}cancel(){var e;for(let[t,a]of(null==(e=this.worker)||e.postMessage({type:"cancel"}),this.pending)){try{a.reject(Error("Operation cancelled"))}catch(e){}this.pending.delete(t)}}dispose(){if(this.worker){try{this.worker.postMessage({type:"dispose"})}catch(e){}this.worker.terminate()}this.worker=null}constructor(){this.worker=null,this.pool=[],this.poolSize=0,this.pending=new Map,this.lastReport=null}}function x(e){return e<0?0:e>1?1:e}function g(e,t){var a,r,l,s;let n=e.width,i=e.height;if(!t||!1===t.enabled)return new ImageData(new Uint8ClampedArray(e.data),n,i);let o=new Uint8ClampedArray(e.data),d=null!=(a=t.vibrance)?a:0;Math.abs(d)>1e-6&&function(e,t,a,r){if(1e-6>Math.abs(r))return;let l=Math.max(-1,Math.min(1,r));for(let t=0;t<e.length;t+=4){let a=e[t]/255,{h:r,s:s,l:n}=function(e,t,a){let r=Math.max(e,t,a),l=Math.min(e,t,a),s=0,n=0,i=(r+l)/2;if(r!==l){let o=r-l;switch(n=i>.5?o/(2-r-l):o/(r+l),r){case e:s=(t-a)/o+6*(t<a);break;case t:s=(a-e)/o+2;break;case a:s=(e-t)/o+4}s/=6}return{h:s,s:n,l:i}}(a,e[t+1]/255,e[t+2]/255),i=s;l>=0?i+=l*(1-i):i+=l*i;let{r:o,g:d,b:c}=function(e,t,a){let r,l,s;if(0===t)r=l=s=a;else{let n=(e,t,a)=>(a<0&&(a+=1),a>1&&(a-=1),a<1/6)?e+(t-e)*6*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e,i=a<.5?a*(1+t):a+t-a*t,o=2*a-i;r=n(o,i,e+1/3),l=n(o,i,e),s=n(o,i,e-1/3)}return{r,g:l,b:s}}(r,i=x(i),n);e[t]=Math.round(255*x(o)),e[t+1]=Math.round(255*x(d)),e[t+2]=Math.round(255*x(c))}}(o,0,0,d);let c=null!=(r=t.unsharpAmount)?r:0,u=null!=(l=t.unsharpRadius)?l:0,h=null!=(s=t.unsharpThreshold)?s:0;return c>1e-6&&u>0&&function(e,t,a,r,l,s){let n=Math.max(0,r);if(n<=1e-6||l<=0)return;let i=Math.max(0,Math.min(1,s)),o=new Float32Array(t*a);for(let t=0,a=0;t<e.length;t+=4,a++){let r=e[t]/255,l=e[t+1]/255,s=e[t+2]/255;o[a]=.2126*r+.7152*l+.0722*s}let d=function(e,t,a,r){if(r<=0)return e.slice();let l=Math.max(1,Math.floor(r)),s=2*l+1,n=new Float32Array(t*a),i=new Float32Array(t*a);for(let r=0;r<a;r++){let a=0;for(let s=-l;s<=l;s++){let l=Math.min(t-1,Math.max(0,s));a+=e[r*t+l]}for(let i=0;i<t;i++){n[r*t+i]=a/s;let o=Math.min(t-1,Math.max(0,i-l)),d=Math.min(t-1,Math.max(0,i+l+1));a+=e[r*t+d]-e[r*t+o]}}for(let e=0;e<t;e++){let r=0;for(let s=-l;s<=l;s++)r+=n[Math.min(a-1,Math.max(0,s))*t+e];for(let o=0;o<a;o++){i[o*t+e]=r/s;let d=Math.min(a-1,Math.max(0,o-l));r+=n[Math.min(a-1,Math.max(0,o+l+1))*t+e]-n[d*t+e]}}return i}(o,t,a,Math.max(1,Math.floor(l)));for(let r=0;r<a;r++)for(let a=0;a<t;a++){let l=r*t+a,s=4*l,c=o[l],u=c-d[l];i>0&&Math.abs(u)<i&&(u=0);let h=x(c+n*u)/(c+1e-6),m=x(e[s]/255*h),g=x(e[s+1]/255*h),p=x(e[s+2]/255*h);e[s]=Math.round(255*m),e[s+1]=Math.round(255*g),e[s+2]=Math.round(255*p)}}(o,n,i,c,u,h),new ImageData(o,n,i)}function p(){var e,t,a,u,x,p,b,f,y,v,w,j,M,k,N,S,C,z,R,E,D,P,I,A,T,q,L,W,U,H,F,O,B,_,G,J,V,X,K,Q,Y,Z,$,ee,et;let[ea,er]=(0,l.useState)(null),[el,es]=(0,l.useState)(null),[en,ei]=(0,l.useState)(null),[eo,ed]=(0,l.useState)(null),[ec,eu]=(0,l.useState)(null),[eh,em]=(0,l.useState)(1),[ex,eg]=(0,l.useState)(!1),[ep,eb]=(0,l.useState)(0),[ef,ey]=(0,l.useState)(!0),[ev,ew]=(0,l.useState)(null),[ej,eM]=(0,l.useState)([]),[ek,eN]=(0,l.useState)(-1),eS=(0,l.useRef)(null),[eC,ez]=(0,l.useState)({...c,...null==(e=d[0])?void 0:e.params}),[eR,eE]=(0,l.useState)({enabled:null==(z=null==(a=d[0])||null==(t=a.preprocess)?void 0:t.enabled)||z,blurEnabled:null==(R=null==(x=d[0])||null==(u=x.preprocess)?void 0:u.blurEnabled)||R,blurRadius:null!=(E=null==(b=d[0])||null==(p=b.preprocess)?void 0:p.blurRadius)?E:2,blurAmount:null!=(D=null==(y=d[0])||null==(f=y.preprocess)?void 0:f.blurAmount)?D:.2,saturation:null!=(P=null==(w=d[0])||null==(v=w.preprocess)?void 0:v.saturation)?P:1.05,brightness:null!=(I=null==(M=d[0])||null==(j=M.preprocess)?void 0:j.brightness)?I:1,warmth:null!=(A=null==(N=d[0])||null==(k=N.preprocess)?void 0:k.warmth)?A:0,tint:null!=(T=null==(C=d[0])||null==(S=C.preprocess)?void 0:S.tint)?T:0}),[eD,eP]=(0,l.useState)(1536),[eI,eA]=(0,l.useState)(1536),[eT,eq]=(0,l.useState)(!1),[eL,eW]=(0,l.useState)(512),[eU,eH]=(0,l.useState)(!0),[eF,eO]=(0,l.useState)(!1),[eB,e_]=(0,l.useState)(null),[eG,eJ]=(0,l.useState)("area"),[eV,eX]=(0,l.useState)(360),[eK,eQ]=(0,l.useState)(null),[eY,eZ]=(0,l.useState)(null),[e$,e0]=(0,l.useState)(null),[e1,e2]=(0,l.useState)(null),[e5,e6]=(0,l.useState)({enabled:!0,vibrance:.1,unsharpAmount:.2,unsharpRadius:1,unsharpThreshold:.02}),[e4,e3]=(0,l.useState)(null),e8=(0,l.useRef)(null),e7=(0,l.useRef)(null),e9=(0,l.useRef)(0),[te,tt]=(0,l.useState)(!1),[ta,tr]=(0,l.useState)(!1),[tl,ts]=(0,l.useState)(!1),[tn,ti]=(0,l.useState)(null),[to,td]=(0,l.useState)(!1),[tc,tu]=(0,l.useState)(!1),th=(0,l.useCallback)(()=>{var e,t;return{img:null!=ea?ea:null,mode:eG,params:eC,pp:eR,post:e5,minShortSide:eD,maxShortSide:eI,area:"area"===eG?{cx:null!=(e=null==eK?void 0:eK.x)?e:null,cy:null!=(t=null==eK?void 0:eK.y)?t:null,size:eV}:null,perf:{stabilityMode:eT,tileSizePx:eL,parallelWorkers:eU,autoTileSize:eF}}},[eC,eR,e5,eG,ea,eD,eI,eK,eV,eT,eL,eU,eF]);(0,l.useEffect)(()=>(e7.current=new m,()=>{var e;return null==(e=e7.current)?void 0:e.dispose()}),[]);let tm=e=>{try{var t;null==(t=e7.current)||t.cancel()}catch(e){}es(null),eu(null),ei(null),ed(null),eQ(null),eZ(null),e0(null),e2(null),e3(null),ts(!1),tr(!1),ti(null),td(!1),e_(null);let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let t=a.naturalWidth,r=a.naturalHeight,l=Math.min(t,r),s=e;if(eI>0&&l>eI){let e=Math.max(1e-4,eI/l),n=Math.max(1,Math.floor(t*e)),i=Math.max(1,Math.floor(r*e)),o=document.createElement("canvas");o.width=n,o.height=i;let d=o.getContext("2d",{willReadFrequently:!0});if(d){try{d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high"}catch(e){}d.drawImage(a,0,0,n,i);try{s=o.toDataURL("image/png")}catch(e){try{s=o.toDataURL("image/jpeg",.95)}catch(e){}}}}er(s);let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=n.naturalWidth,a=n.naturalHeight;try{e_({origW:t,origH:r,workW:e,workH:a})}catch(e){}let l=Math.max(8,Math.min(Math.floor(eV),Math.min(e,a))),s=Math.floor(l/2),i=Math.floor(e/2),o=Math.floor(a/2),d=Math.max(0,Math.min(i-s,e-l)),c=Math.max(0,Math.min(o-s,a-l));eQ({x:i,y:o}),e3({left:d,top:c,size:l}),eZ(null),e0(null),es(n)},n.src=s},a.src=e},tx=(0,l.useCallback)(async()=>{var e,t,a,r,l,s,n,i,o,d,c;if(!el||!e7.current)return;let u=++e9.current;try{e7.current.cancel()}catch(e){}let h=(e=>{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;let a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw Error("2D context");return a.drawImage(e,0,0),a.getImageData(0,0,t.width,t.height)})(el),m=new ImageData(new Uint8ClampedArray(h.data),h.width,h.height);eg(!0),eb(1);try{let c=eT?{...eC,kernelSize:Math.min(eC.kernelSize,48),anisotropy:Math.min(eC.anisotropy,5),sectors:Math.min(null!=(e=eC.sectors)?e:6,4),order:Math.min(null!=(t=eC.order)?t:2,2),flowSigma:Math.min(null!=(a=eC.flowSigma)?a:2.4,2),radiusMaxScale:Math.min(null!=(r=eC.radiusMaxScale)?r:1.25,1.1),sigmaSpatial:Math.min(null!=(l=eC.sigmaSpatial)?l:.7,.8),sigmaRange:Math.max(.08,Math.min(null!=(s=eC.sigmaRange)?s:.12,.2)),quantizeLevels:Math.min(null!=(n=eC.quantizeLevels)?n:8,8),quantizeDither:Math.min(null!=(i=eC.quantizeDither)?i:.35,.35),edgeSigma:Math.min(null!=(o=eC.edgeSigma)?o:1,1),edgeMix:Math.min(null!=(d=eC.edgeMix)?d:.18,.2)}:eC;if("compare"===eG){let e=Math.min(h.width,h.height),t=1;t=e<eD?Math.max(1,Math.ceil(eD/Math.max(1,e))):eI>0&&e>eI?Math.max(.0625,eI/Math.max(1,e)):1,e9.current===u&&eu(m);let a=eT?Math.min(eL,256):eF?void 0:eL,r=eU?e7.current.processPool.bind(e7.current):e7.current.process.bind(e7.current),l=await r(h,{...c,upscaleFactor:Math.max(1,t),preserveSettings:!0},{onProgress:e=>{e9.current===u&&eb(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{e9.current===u&&(ew(e),eM(t=>[e,...t].slice(0,10)))}},{scale:t,preprocess:eR,..."number"==typeof a?{tileSize:a}:{}});e9.current===u&&(ed(l),ei(e5.enabled?g(l,e5):l),eb(100),ts(!0),tr(!1),ti(th())),e2(null)}else{let e=Math.max(8,Math.min(Math.floor(eV),h.width,h.height)),t=null!=eK?eK:{x:Math.floor(h.width/2),y:Math.floor(h.height/2)},a=Math.floor(e/2),r=Math.max(0,Math.min(t.x-a,h.width-e)),l=Math.max(0,Math.min(t.y-a,h.height-e)),s=document.createElement("canvas");s.width=h.width,s.height=h.height;let n=s.getContext("2d",{willReadFrequently:!0});if(!n)throw Error("2D context");n.putImageData(h,0,0);let i=document.createElement("canvas");i.width=e,i.height=e;let o=i.getContext("2d",{willReadFrequently:!0});if(!o)throw Error("2D context");o.drawImage(s,r,l,e,e,0,0,e,e);let d=o.getImageData(0,0,e,e);if(e9.current!==u)return;eQ(t),e3({left:r,top:l,size:e});let m=new ImageData(new Uint8ClampedArray(d.data),d.width,d.height);eZ(m),e0(null);let x=eT?Math.min(eL,256):eF?void 0:eL,p=eU?e7.current.processPool.bind(e7.current):e7.current.process.bind(e7.current),b=await p(d,{...c,upscaleFactor:1,preserveSettings:!0},{onProgress:e=>{e9.current===u&&eb(Math.max(1,Math.min(99,Math.round(100*e))))},onReport:e=>{e9.current===u&&(ew(e),eM(t=>[e,...t].slice(0,10)))}},{scale:1,preprocess:eR,..."number"==typeof x?{tileSize:x}:{}});e9.current===u&&(e2(b),e0(e5.enabled?g(b,e5):b),eb(100),ts(!0),tr(!1),ti(th()))}}catch(t){let e=(null==t?void 0:t.message)||String(t);if("Operation cancelled"!==e&&(console.error(t),/webgl|context lost|webgl2|exhausted|limits unavailable|failed to create webgl/i.test(e))){ey(!1);try{null==(c=e7.current)||c.dispose()}catch(e){}}}finally{e9.current===u&&eg(!1)}},[el,eC,eD,eI,eR,eT,eG,eV,eK,eL,eF,eU,e5,th]),tg=(0,l.useCallback)(()=>{let e=e8.current;if(!e)return;let t=e.naturalWidth,a=e.naturalHeight;if(!t||!a)return;let r=Math.max(8,Math.min(Math.floor(eV),Math.min(t,a))),l=Math.floor(r/2),s=Math.floor(t/2),n=Math.floor(a/2),i=Math.max(0,Math.min(s-l,t-r)),o=Math.max(0,Math.min(n-l,a-r));eQ({x:s,y:n}),e3({left:i,top:o,size:r}),eZ(null),e0(null),es(e)},[eV]);return(0,l.useEffect)(()=>{if(el){try{var e;null==(e=e7.current)||e.cancel()}catch(e){}tx()}},[el]),(0,l.useEffect)(()=>{if(el&&(te||!tl)){try{var e;null==(e=e7.current)||e.cancel()}catch(e){}let t=setTimeout(()=>{tx()},300);return()=>{clearTimeout(t);try{var e;null==(e=e7.current)||e.cancel()}catch(e){}}}},[eC,eR,eD,eI,eG,te,tx,tl,el]),(0,l.useEffect)(()=>{if(el&&(te||!tl)){try{var e;null==(e=e7.current)||e.cancel()}catch(e){}let t=setTimeout(()=>{tx()},150);return()=>{clearTimeout(t);try{var e;null==(e=e7.current)||e.cancel()}catch(e){}}}},[eK,eV,te,tx,tl,el]),(0,l.useEffect)(()=>{if(!el)return},[eT,eL,el]),(0,l.useEffect)(()=>{var e;if(!eo)return;let t=te||!tl?e5:null!=(e=null==tn?void 0:tn.post)?e:e5;ei((null==t?void 0:t.enabled)?g(eo,t):eo)},[eo,te,tl,tn,e5]),(0,l.useEffect)(()=>{var e;if(!e1)return;let t=te||!tl?e5:null!=(e=null==tn?void 0:tn.post)?e:e5;e0((null==t?void 0:t.enabled)?g(e1,t):e1)},[e1,te,tl,tn,e5]),(0,l.useEffect)(()=>{(!tl||te)&&(eo&&ei(e5.enabled?g(eo,e5):eo),e1&&e0(e5.enabled?g(e1,e5):e1))},[e5]),(0,l.useEffect)(()=>{if(!tl||ex||!tn){tr(!1),td(!1);return}let e=!((e,t)=>{try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(th(),tn);tr(e),e&&!te&&td(!0),e||td(!1)},[tl,ex,te,tn,th]),(0,l.useEffect)(()=>{ex&&to&&td(!1)},[ex,to]),(0,r.jsxs)("div",{className:"flex h-screen text-gray-900 dark:text-gray-100",children:[(0,r.jsxs)("aside",{className:"w-[340px] max-h-full shrink-0 dark:border-gray-800 p-4 space-y-6 overflow-y-auto",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"w-full block text-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer text-xs",children:["Upload",(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(e=>{let t=new FileReader;t.onload=()=>tm(String(t.result)),t.readAsDataURL(e)})(a)}})]}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:h.map(e=>{let t=ea===e.src;return(0,r.jsx)("button",{onClick:()=>(e=>{let t=d[e.presetIdx];if(ez(e=>({...e,...t.params})),t.preprocess){let e=t.preprocess;eE(t=>{var a,r,l,s,n,i,o,d;return{...t,enabled:null==(a=e.enabled)||a,blurEnabled:null==(r=e.blurEnabled)||r,blurRadius:null!=(l=e.blurRadius)?l:t.blurRadius,blurAmount:null!=(s=e.blurAmount)?s:t.blurAmount,saturation:null!=(n=e.saturation)?n:t.saturation,brightness:null!=(i=e.brightness)?i:t.brightness,warmth:null!=(o=e.warmth)?o:t.warmth,tint:null!=(d=e.tint)?d:t.tint}})}tm(e.src)})(e),className:"relative aspect-square rounded overflow-hidden border focus:outline-none "+(t?"ring-2 ring-blue-500 border-blue-500":"border-gray-300 dark:border-gray-700 hover:border-blue-400 dark:hover:outline-blue-400"),"aria-pressed":t,children:(0,r.jsx)("img",{src:e.src,alt:e.name,loading:"lazy",className:"w-full h-full object-cover"})},e.src)})}),eB&&(eB.origW!==eB.workW||eB.origH!==eB.workH)&&(0,r.jsxs)("div",{className:"text-[11px] mt-1 p-2 rounded border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-white/5",children:["Resized large image: ",eB.origW,"\xd7",eB.origH," → ",eB.workW,"\xd7",eB.workH]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Presets"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:d.map(e=>(0,r.jsx)("button",{className:"px-2 py-2 text-xs rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-200/60 dark:hover:bg-gray-700/60",onClick:()=>{ez(t=>({...t,...e.params})),e.preprocess&&eE(t=>{var a,r,l,s,n,i,o,d;return{...t,enabled:null==(a=e.preprocess.enabled)||a,blurEnabled:null==(r=e.preprocess.blurEnabled)||r,blurRadius:null!=(l=e.preprocess.blurRadius)?l:t.blurRadius,blurAmount:null!=(s=e.preprocess.blurAmount)?s:t.blurAmount,saturation:null!=(n=e.preprocess.saturation)?n:t.saturation,brightness:null!=(i=e.preprocess.brightness)?i:t.brightness,warmth:null!=(o=e.preprocess.warmth)?o:t.warmth,tint:null!=(d=e.preprocess.tint)?d:t.tint}})},children:e.name},e.name))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Output & Performance"}),(0,r.jsx)(n,{label:"Min short side (px)",value:eD,min:256,max:8192,step:64,subtitle:"Upscales the short image edge (higher = more detail and time).",onChange:eP}),(0,r.jsx)(n,{label:"Max short side (px)",value:eI,min:512,max:8192,step:64,subtitle:"Downscales large images to fit (lower = faster).",onChange:eA}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:te,onChange:e=>{let t=e.target.checked;if(t&&ta&&tl&&!ex){td(!0);try{var a;null==(a=e7.current)||a.cancel()}catch(e){}tx()}tt(t)}})," ","Auto render on edit"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eT,onChange:e=>eq(e.target.checked)})," ","Stability mode"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eU,onChange:e=>eH(e.target.checked)})," ","Parallel render (2 workers)"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eF,onChange:e=>eO(e.target.checked),disabled:eT})," ","Auto tile size (capability-based)"]}),(0,r.jsx)(n,{label:"Tile size (px)",value:eL,disabled:eT||eF,min:128,max:2048,step:64,subtitle:"Larger tiles are faster but use more GPU memory. Stability mode caps at 256. Auto tile picks based on GPU capability.",onChange:eW}),(0,r.jsx)(n,{label:"Tile size of Area Preview (px)",value:eV,min:64,max:1024,step:16,onChange:e=>eX(e)})]}),(0,r.jsxs)("details",{className:"space-y-4",open:!0,children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Style"}),(0,r.jsx)(n,{label:"Brush size",value:eC.kernelSize,min:1,max:200,step:1,subtitle:"Approximate stroke size (larger = broader strokes).",onChange:e=>ez(t=>({...t,kernelSize:e}))}),(0,r.jsx)(n,{label:"Directionality",value:eC.anisotropy,min:1,max:8,step:.1,subtitle:"Align strokes with local structure (higher = more aligned).",onChange:e=>ez(t=>({...t,anisotropy:e}))}),(0,r.jsx)(n,{label:"Sharpness",value:eC.sharpness,min:1,max:10,step:.1,subtitle:"Local contrast within strokes (higher = crisper).",onChange:e=>ez(t=>({...t,sharpness:e}))}),(0,r.jsx)(n,{label:"Stylization",value:eC.alpha,min:.1,max:2,step:.05,subtitle:"Strength of abstraction vs. fidelity.",onChange:e=>ez(t=>({...t,alpha:e}))}),(0,r.jsx)(n,{label:"Edge preservation",value:eC.threshold,min:.01,max:1,step:.01,subtitle:"Preserve edges across regions (higher = fewer bleeds).",onChange:e=>ez(t=>({...t,threshold:e}))}),(0,r.jsx)(n,{label:"Levels",value:null!=(q=eC.quantizeLevels)?q:0,min:0,max:128,step:1,subtitle:"Posterize to N color bands.",onChange:e=>ez(t=>({...t,quantizeLevels:e}))}),(0,r.jsx)(n,{label:"Strength",value:null!=(L=eC.quantizeStrength)?L:.6,min:0,max:1,step:.05,subtitle:"Blend toward posterized colors (0 = off).",onChange:e=>ez(t=>({...t,quantizeStrength:e}))}),(0,r.jsx)(n,{label:"Dither",value:null!=(W=eC.quantizeDither)?W:.35,min:0,max:1,step:.05,subtitle:"Add fine noise to reduce visible banding.",onChange:e=>ez(t=>({...t,quantizeDither:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Pre‑render"}),(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 leading-4",children:"Runs before the painterly filter. Reduces small noise and JPEG artifacts while preserving edges; helps stability at high upscales."}),(0,r.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eR.enabled,onChange:e=>eE({...eR,enabled:e.target.checked})})," ","Enable pre‑render"]}),(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:eR.blurEnabled,onChange:e=>eE({...eR,blurEnabled:e.target.checked}),disabled:!eR.enabled})," ","Edge-aware smoothing"]})]}),(0,r.jsx)(n,{label:"Blur radius",value:eR.blurRadius,min:0,max:16,step:1,subtitle:"Kernel size in pixels (higher softens more, pair with low amount).",onChange:e=>eE({...eR,blurRadius:e}),disabled:!eR.enabled||!eR.blurEnabled}),(0,r.jsx)(n,{label:"Blur amount",value:eR.blurAmount,min:0,max:1,step:.05,subtitle:"Mix strength in flat regions (edges are preserved).",onChange:e=>eE({...eR,blurAmount:e}),disabled:!eR.enabled||!eR.blurEnabled}),(0,r.jsx)(n,{label:"Saturation",value:eR.saturation,min:0,max:2,step:.05,subtitle:"Global color intensity before stylizing.",onChange:e=>eE({...eR,saturation:e}),disabled:!eR.enabled}),(0,r.jsx)(n,{label:"Brightness",value:eR.brightness,min:0,max:2,step:.05,subtitle:"Global brightness multiplier before stylizing.",onChange:e=>eE({...eR,brightness:e}),disabled:!eR.enabled}),(0,r.jsx)(n,{label:"Warmth",value:eR.warmth,min:-1,max:1,step:.05,subtitle:"Bias reds vs blues (positive = warmer).",onChange:e=>eE({...eR,warmth:e}),disabled:!eR.enabled}),(0,r.jsx)(n,{label:"Tint",value:eR.tint,min:-1,max:1,step:.05,subtitle:"Bias green vs magenta before stylizing.",onChange:e=>eE({...eR,tint:e}),disabled:!eR.enabled})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Post‑render"}),(0,r.jsx)("div",{className:"flex flex-col space-y-4",children:(0,r.jsxs)("label",{className:"text-xs flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!e5.enabled,onChange:e=>e6({...e5,enabled:e.target.checked})})," ","Enable"]})}),(0,r.jsx)(n,{label:"Vibrance",value:null!=(U=e5.vibrance)?U:0,min:-1,max:1,step:.05,subtitle:"Boost muted colors while protecting already saturated ones.",onChange:e=>e6({...e5,vibrance:e}),disabled:!e5.enabled}),(0,r.jsx)(n,{label:"Unsharp amount",value:null!=(H=e5.unsharpAmount)?H:0,min:0,max:2,step:.05,subtitle:"Detail boost strength after render.",onChange:e=>e6({...e5,unsharpAmount:e}),disabled:!e5.enabled}),(0,r.jsx)(n,{label:"Unsharp radius",value:null!=(F=e5.unsharpRadius)?F:0,min:0,max:8,step:1,subtitle:"Blur radius for mask (small = crisp, large = broad clarity).",onChange:e=>e6({...e5,unsharpRadius:e}),disabled:!e5.enabled}),(0,r.jsx)(n,{label:"Unsharp threshold",value:null!=(O=e5.unsharpThreshold)?O:0,min:0,max:.25,step:.005,subtitle:"Protect flat areas from sharpening (higher = safer).",onChange:e=>e6({...e5,unsharpThreshold:e}),disabled:!e5.enabled})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Stroke & coherence"}),(0,r.jsx)(n,{label:"Sectors",value:null!=(B=eC.sectors)?B:6,min:1,max:32,step:1,subtitle:"Number of stroke directions (more = smoother, slower).",onChange:e=>ez(t=>({...t,sectors:e}))}),(0,r.jsx)(n,{label:"Contrast blend (p)",value:null!=(_=eC.order)?_:1,min:0,max:6,step:.5,subtitle:"Aggressiveness when picking a dominant direction.",onChange:e=>ez(t=>({...t,order:e}))}),(0,r.jsx)(n,{label:"Flow scale",value:null!=(G=eC.flowSigma)?G:2,min:0,max:6,step:.5,subtitle:"Neighborhood size for structure (higher = longer strokes).",onChange:e=>ez(t=>({...t,flowSigma:e}))}),(0,r.jsx)(n,{label:"Adaptive",value:null!=(J=eC.adaptStrength)?J:.75,min:0,max:1,step:.05,subtitle:"Vary stroke size by detail (pairs with Min/Max brush).",onChange:e=>ez(t=>({...t,adaptStrength:e}))}),(0,r.jsx)(n,{label:"Min brush",value:null!=(V=eC.radiusMinScale)?V:.35,min:.1,max:1,step:.05,subtitle:"Lower bound for adaptive stroke size.",onChange:e=>ez(t=>({...t,radiusMinScale:e}))}),(0,r.jsx)(n,{label:"Max brush",value:null!=(X=eC.radiusMaxScale)?X:1,min:.5,max:1.5,step:.05,subtitle:"Upper bound for adaptive stroke size.",onChange:e=>ez(t=>({...t,radiusMaxScale:e}))}),(0,r.jsx)(n,{label:"Local softness",value:null!=(K=eC.sigmaSpatial)?K:.5,min:.1,max:20,step:.05,subtitle:"Softness within a sector (higher = smoother, less texture).",onChange:e=>ez(t=>({...t,sigmaSpatial:e}))}),(0,r.jsx)(n,{label:"Color edge sens.",value:null!=(Q=eC.sigmaRange)?Q:.15,min:.01,max:1,step:.01,subtitle:"Sensitivity to color changes (lower = more edge-preserving).",onChange:e=>ez(t=>({...t,sigmaRange:e}))})]}),(0,r.jsxs)("details",{className:"space-y-4",children:[(0,r.jsx)("summary",{className:"text-sm font-semibold cursor-pointer",children:"Ink outlines"}),(0,r.jsx)(n,{label:"Ink sigma",value:null!=(Y=eC.edgeSigma)?Y:0,min:.1,max:3,step:.1,subtitle:"Edge scale (blur radius) used to detect lines.",onChange:e=>ez(t=>({...t,edgeSigma:e}))}),(0,r.jsx)(n,{label:"Ink threshold (τ)",value:null!=(Z=eC.edgeTau)?Z:0,min:.001,max:.02,step:.001,subtitle:"Lower finds more lines (higher suppresses weak lines).",onChange:e=>ez(t=>({...t,edgeTau:e}))}),(0,r.jsx)(n,{label:"Ink slope (φ)",value:null!=($=eC.edgePhi)?$:10,min:1,max:20,step:1,subtitle:"Line steepness/contrast.",onChange:e=>ez(t=>({...t,edgePhi:e}))}),(0,r.jsx)(n,{label:"Ink mix",value:null!=(ee=eC.edgeMix)?ee:0,min:0,max:1,step:.05,subtitle:"How much ink overlay to add to the painting.",onChange:e=>ez(t=>({...t,edgeMix:e}))})]})]}),(0,r.jsxs)("main",{className:"flex flex-col flex-1 p-4",children:[(0,r.jsxs)("div",{className:"flex-none flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mr-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("area"===eG?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>eJ("area"),children:"Area Preview"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+("compare"===eG?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>eJ("compare"),children:"Full Preview"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>em(e=>Math.max(.25,e-.25)),children:"−"}),(0,r.jsxs)("span",{className:"text-xs w-16 text-center",children:[Math.round(100*eh),"%"]}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>em(e=>Math.min(4,e+.25)),children:"+"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700",onClick:()=>em(1),children:"Reset"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border "+(tc?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>tu(e=>!e),title:tc?"Hide diagnostics":"Show diagnostics",children:"Diagnostics"}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-700 disabled:opacity-50",disabled:!en||ex,onClick:()=>{if(!en)return;let e=document.createElement("canvas");e.width=en.width,e.height=en.height;let t=e.getContext("2d");t&&(t.putImageData(en,0,0),e.toBlob(e=>{if(!e)return;let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="kuwahara-".concat(Date.now(),".png"),a.click(),setTimeout(()=>{try{URL.revokeObjectURL(t)}catch(e){}},0)},"image/png"))},children:"Download PNG"})]})]}),(0,r.jsxs)("div",{className:"relative flex-1 flex flex-col justify-center bg-gray-200 dark:bg-gray-800 rounded-xl min-h-[360px]",children:[(0,r.jsxs)("div",{className:"flex-none max-h-full overflow-y-auto p-4",children:[!ea&&(0,r.jsx)("div",{className:"h-[480px] flex items-center justify-center text-sm text-gray-500",children:"No image loaded"}),ea&&"compare"===eG&&ec&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{className:"w-full",labels:{before:"Before",after:ef?ex||!en?"Previewing…":"After":"GPU unavailable"},before:(0,r.jsx)(i,{imageData:ec,zoom:eh}),after:ex||!en?(0,r.jsx)(i,{imageData:ec,zoom:eh,cssFilter:"blur(8px)"}):(0,r.jsx)(i,{imageData:en,zoom:eh})}),ex&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[ep,"%"]})]}),ea&&"area"===eG&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsxs)("div",{className:"relative overflow-clip inline-block max-w-full",style:{maxWidth:"400px",maxHeight:"400px"},children:[(0,r.jsx)("img",{ref:e8,src:ea,alt:"original",crossOrigin:"anonymous",className:"max-w-full h-auto rounded",onClick:e=>{if(!el||!e8.current)return;let t=e8.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,l=el.naturalWidth/Math.max(1,t.width),s=el.naturalHeight/Math.max(1,t.height),n=Math.floor(a*l),i=Math.floor(r*s),o=Math.max(8,Math.min(eV,Math.min(el.naturalWidth,el.naturalHeight))),d=Math.floor(o/2),c=Math.max(d,Math.min(n,el.naturalWidth-d)),u=Math.max(d,Math.min(i,el.naturalHeight-d));eQ({x:c,y:u}),e3({left:Math.max(0,Math.min(c-d,el.naturalWidth-o)),top:Math.max(0,Math.min(u-d,el.naturalHeight-o)),size:o})},onLoad:tg}),el&&(0,r.jsx)(o,{imageEl:e8.current,naturalWidth:el.naturalWidth,naturalHeight:el.naturalHeight,areaCenter:eK,areaSize:eV,areaAfter:e$,isBusy:ex,areaCrop:e4})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-4xl mx-auto",children:[(0,r.jsx)("div",{className:"aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:eY?(0,r.jsx)(i,{imageData:eY,zoom:1}):(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Pick a point"})}),(0,r.jsxs)("div",{className:"relative aspect-square bg-black/5 dark:bg-white/5 rounded flex items-center justify-center overflow-hidden",children:[ex&&eY&&!e$&&(0,r.jsx)(i,{imageData:eY,zoom:1,cssFilter:"blur(8px)"}),e$&&(0,r.jsx)(i,{imageData:e$,zoom:1}),ex&&(0,r.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs px-2 py-1 rounded bg-black/60 text-white",children:[ep,"%"]})]})]})]})]}),tl&&!ex&&(ta&&!te||to)&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"px-4 py-3 rounded-md bg-black/60 text-white text-xs flex items-center gap-3 shadow-lg",children:[(0,r.jsx)("span",{children:"Settings changed. Re-render now?"}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-white/40 bg-white/10 hover:bg-white/20",onClick:()=>{try{var e;null==(e=e7.current)||e.cancel()}catch(e){}tr(!1),td(!1),tx()},children:"Re-render"})]})}),!ef&&(0,r.jsxs)("div",{className:"absolute left-4 bottom-4 right-4 sm:right-auto sm:max-w-xl text-xs px-3 py-2 rounded bg-yellow-200/90 text-yellow-900 dark:bg-yellow-500/20 dark:text-yellow-200 border border-yellow-400/60 flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{children:"GPU/WebGL became unavailable. Results are limited. Try retrying or reloading."}),ev&&(0,r.jsxs)("div",{className:"mt-1 text-[11px] text-yellow-900/90 dark:text-yellow-200/80",children:[(0,r.jsxs)("span",{className:"mr-2",children:["Failed step: ",(0,r.jsx)("b",{children:null!=(et=ev.failedStep)?et:"—"})]}),!!(ev.errors&&ev.errors.length)&&(0,r.jsxs)("span",{className:"mr-2",children:["Error:"," ","".concat(ev.errors[0].where,":").concat(ev.errors[0].label)]}),ev.vendor&&ev.renderer&&(0,r.jsxs)("span",{className:"mr-2",children:["GPU: ",ev.vendor," \xb7 ",ev.renderer]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[ev&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:()=>{tu(!0),setTimeout(()=>{try{var e;null==(e=eS.current)||e.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}},0)},title:"Scroll to diagnostics",children:"Details"}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/70 dark:bg-white/10",onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(ev,null,2))}catch(e){}},title:"Copy report JSON",children:"Copy report"})]}),(0,r.jsx)("button",{className:"px-2 py-1 rounded border border-yellow-700/30 bg-white/60 dark:bg-white/10",onClick:()=>{ey(!0);try{var e;null==(e=e7.current)||e.dispose()}catch(e){}e7.current=new m;try{tx()}catch(e){}},children:"Retry"})]})]})]}),tc&&(0,r.jsxs)("div",{ref:eS,className:"mt-3 text-[11px] leading-5 bg-white/70 dark:bg-black/30 backdrop-blur rounded border border-gray-300 dark:border-gray-700 p-3 max-w-full overflow-x-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Render Diagnostics"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-gray-600 dark:text-gray-300",children:ev?ek>=0?"Viewing history #".concat(ek+1):"Latest report":"No render yet"}),(0,r.jsx)("button",{className:"px-2 py-0.5 rounded border text-[10px] border-gray-300 dark:border-gray-700",onClick:()=>tu(!1),title:"Hide diagnostics",children:"Hide"})]})]}),(0,r.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,r.jsx)("span",{className:"text-[10px] text-gray-500",children:"History:"}),0===ej.length&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400",children:"—"}),ej.map((e,t)=>{var a,l,s,n,i;return(0,r.jsxs)("button",{className:"px-2 py-0.5 rounded border text-[10px] ".concat(t===ek?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-700"),onClick:()=>eN(t===ek?-1:t),title:"Select report ".concat(t+1),"aria-pressed":t===ek,children:[null!=(l=e.mode)?l:"fast","/",Math.round(null!=(n=null!=(s=e.durationMs)?s:null==(a=e.worker)?void 0:a.overallMs)?n:0),"ms"]},(null!=(i=e.requestId)?i:"")+"-"+t)}),ej.length>0&&(0,r.jsx)("button",{className:"ml-2 px-2 py-0.5 rounded border text-[10px] border-gray-300 dark:border-gray-700",onClick:()=>{eM([]),eN(-1)},children:"Clear"}),ek>=0&&(0,r.jsx)("button",{className:"ml-1 px-2 py-0.5 rounded border text-[10px] border-gray-300 dark:border-gray-700",onClick:()=>eN(-1),title:"View latest report",children:"Latest"})]}),(()=>{var e,t,a,l,s,n,i,o,d,c,u,h,m,x,g;let p=ek>=0?ej[ek]:ev;return p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Mode:"})," ",p.mode]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Failed step:"})," ",null!=(t=p.failedStep)?t:"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Duration:"})," ",Math.round(null!=(l=null!=(a=p.durationMs)?a:null==(e=p.worker)?void 0:e.overallMs)?l:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"GPU time:"})," ",p.gpuTimeNs?"".concat(Math.round(p.gpuTimeNs/1e6)," ms"):"—"," ",p.gpuDisjoint?"(disjoint)":""]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Original:"})," ",p.originalSize?"".concat(p.originalSize.w,"\xd7").concat(p.originalSize.h):"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Target:"})," ",p.targetSize?"".concat(p.targetSize.w,"\xd7").concat(p.targetSize.h):"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Vendor:"})," ",null!=(s=p.vendor)?s:"—"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Renderer:"})," ",null!=(n=p.renderer)?n:"—"]})]}),!!(p.errors&&p.errors.length)&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Errors:"})," ",p.errors.map(e=>"".concat(e.where,":").concat(e.label)).join(", ")]}),!!(p.notes&&p.notes.length)&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Notes"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1",children:p.notes.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),p.worker&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Worker metrics"}),(0,r.jsxs)("div",{className:"mt-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Canceled:"})," ",p.worker.canceled?"yes":"no"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Retries:"})," ",null!=(i=p.worker.retries)?i:0]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Pre‑render:"})," ",Math.round(null!=(o=p.worker.preprocessMs)?o:0)," ms"]}),p.worker.tiling&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles:"})," ",p.worker.tiling.tilesX,"\xd7",p.worker.tiling.tilesY," ","(",p.worker.tiling.totalTiles,") @"," ",p.worker.tiling.tileSize]}),p.worker.aggregates&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Tiles total:"})," ",Math.round(null!=(d=p.worker.aggregates.tilesTotalMs)?d:0)," ","ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Avg / tile:"})," ",Math.round(null!=(c=p.worker.aggregates.tileAvgMs)?c:0)," ms"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Max tile:"})," ",Math.round(null!=(u=p.worker.aggregates.tileMaxMs)?u:0)," ","ms (#",(null!=(h=p.worker.aggregates.tileMaxIndex)?h:0)+1,")"]})]})]}),p.worker.tiles&&p.worker.tiles.length>0&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Per-tile timings"}),(0,r.jsx)("div",{className:"mt-1 max-h-64 overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-[10px]",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-gray-500",children:[(0,r.jsx)("th",{className:"text-left",children:"Tile"}),(0,r.jsx)("th",{className:"text-right",children:"Crop"}),(0,r.jsx)("th",{className:"text-right",children:"GPU"}),(0,r.jsx)("th",{className:"text-right",children:"Compose"}),(0,r.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,r.jsx)("tbody",{children:p.worker.tiles.map((e,t)=>{var a,l,s,n,i;return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{children:["(",e.tx,",",e.ty,") ",e.wOut,"\xd7",e.hOut]}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(l=e.cropMs)?l:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(s=null==(a=e.gpu)?void 0:a.totalMs)?s:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(n=e.composeMs)?n:0)}),(0,r.jsx)("td",{className:"text-right",children:Math.round(null!=(i=e.totalMs)?i:0)})]},t)})})]})})]})]}),(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Uniforms"}),(0,r.jsx)("pre",{className:"mt-1 text-[10px] whitespace-pre-wrap break-all",children:JSON.stringify(null!=(m=p.uniforms)?m:{},null,2)})]}),p.parallel&&p.parallel.enabled&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer text-gray-500",children:"Parallel"}),(0,r.jsxs)("div",{className:"mt-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Enabled:"})," yes"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Workers:"})," ",null!=(x=p.parallel.poolSize)?x:2]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Merge:"})," ",Math.round(null!=(g=p.parallel.mergeMs)?g:0)," ms"]})]}),p.parallel.bands&&p.parallel.bands.length>0&&(0,r.jsx)("div",{className:"mt-1 max-h-48 overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-[10px]",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-gray-500",children:[(0,r.jsx)("th",{className:"text-left",children:"Band"}),(0,r.jsx)("th",{className:"text-right",children:"Rect"}),(0,r.jsx)("th",{className:"text-right",children:"Duration"})]})}),(0,r.jsx)("tbody",{children:p.parallel.bands.map((e,t)=>{var a;return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{children:["#",e.index+1]}),(0,r.jsxs)("td",{className:"text-right",children:[e.rect.w,"\xd7",e.rect.h," @ y=",e.rect.y]}),(0,r.jsxs)("td",{className:"text-right",children:[Math.round(null!=(a=e.durationMs)?a:0)," ms"]})]},t)})})]})})]})]}):(0,r.jsx)("div",{className:"mt-2 text-[10px] text-gray-600 dark:text-gray-300",children:"Run a render to see diagnostics here."})})()]})]})]})}},5697:(e,t,a)=>{Promise.resolve().then(a.bind(a,3100))}},e=>{e.O(0,[623,358],()=>e(e.s=5697)),_N_E=e.O()}]);